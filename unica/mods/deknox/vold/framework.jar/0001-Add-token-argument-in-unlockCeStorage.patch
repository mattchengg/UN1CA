From 368a926cee2f89080c16f5414f6c79ccf3844f31 Mon Sep 17 00:00:00 2001
From: Salvo Giangreco <giangrecosalvo9@gmail.com>
Date: Thu, 30 Oct 2025 20:27:50 +0100
Subject: [PATCH] Add token argument in unlockCeStorage

---
 smali_classes3/android/os/IVold$Default.smali    | 2 +-
 smali_classes3/android/os/IVold$Stub$Proxy.smali | 6 ++++--
 smali_classes3/android/os/IVold$Stub.smali       | 8 ++++++--
 smali_classes3/android/os/IVold.smali            | 2 +-
 4 files changed, 12 insertions(+), 6 deletions(-)

diff --git a/smali_classes3/android/os/IVold$Default.smali b/smali_classes3/android/os/IVold$Default.smali
index 5d093c5b..d49b2bfa 100644
--- a/smali_classes3/android/os/IVold$Default.smali
+++ b/smali_classes3/android/os/IVold$Default.smali
@@ -1367,7 +1367,7 @@
     return p0
 .end method
 
-.method public blacklist unlockCeStorage(I[B)V
+.method public blacklist unlockCeStorage(ILjava/lang/String;[B)V
     .locals 0
     .annotation system Ldalvik/annotation/Throws;
         value = {
diff --git a/smali_classes3/android/os/IVold$Stub$Proxy.smali b/smali_classes3/android/os/IVold$Stub$Proxy.smali
index c0395d51..13e77c57 100644
--- a/smali_classes3/android/os/IVold$Stub$Proxy.smali
+++ b/smali_classes3/android/os/IVold$Stub$Proxy.smali
@@ -6839,7 +6839,7 @@
     throw p0
 .end method
 
-.method public blacklist unlockCeStorage(I[B)V
+.method public blacklist unlockCeStorage(ILjava/lang/String;[B)V
     .locals 3
     .annotation system Ldalvik/annotation/Throws;
         value = {
@@ -6868,7 +6868,9 @@
 
     invoke-virtual {v0, p1}, Landroid/os/Parcel;->writeInt(I)V
 
-    invoke-virtual {v0, p2}, Landroid/os/Parcel;->writeByteArray([B)V
+    invoke-virtual {v0, p2}, Landroid/os/Parcel;->writeString(Ljava/lang/String;)V
+
+    invoke-virtual {v0, p3}, Landroid/os/Parcel;->writeByteArray([B)V
 
     iget-object p0, p0, Landroid/os/IVold$Stub$Proxy;->mRemote:Landroid/os/IBinder;
 
diff --git a/smali_classes3/android/os/IVold$Stub.smali b/smali_classes3/android/os/IVold$Stub.smali
index 3ecc3950..4976c76f 100644
--- a/smali_classes3/android/os/IVold$Stub.smali
+++ b/smali_classes3/android/os/IVold$Stub.smali
@@ -2163,13 +2163,17 @@
 
     move-result v1
 
-    invoke-virtual {p2}, Landroid/os/Parcel;->createByteArray()[B
+    invoke-virtual {p2}, Landroid/os/Parcel;->readString()Ljava/lang/String;
 
     move-result-object v2
 
+    invoke-virtual {p2}, Landroid/os/Parcel;->createByteArray()[B
+
+    move-result-object v3
+
     invoke-virtual {p2}, Landroid/os/Parcel;->enforceNoDataAvail()V
 
-    invoke-virtual {p0, v1, v2}, Landroid/os/IVold$Stub;->unlockCeStorage(I[B)V
+    invoke-virtual {p0, v1, v2, v3}, Landroid/os/IVold$Stub;->unlockCeStorage(ILjava/lang/String;[B)V
 
     invoke-virtual {p3}, Landroid/os/Parcel;->writeNoException()V
 
diff --git a/smali_classes3/android/os/IVold.smali b/smali_classes3/android/os/IVold.smali
index 72d8cbb7..2865e429 100644
--- a/smali_classes3/android/os/IVold.smali
+++ b/smali_classes3/android/os/IVold.smali
@@ -988,7 +988,7 @@
     .end annotation
 .end method
 
-.method public abstract blacklist unlockCeStorage(I[B)V
+.method public abstract blacklist unlockCeStorage(ILjava/lang/String;[B)V
     .annotation system Ldalvik/annotation/Throws;
         value = {
             Landroid/os/RemoteException;
-- 
2.51.1

