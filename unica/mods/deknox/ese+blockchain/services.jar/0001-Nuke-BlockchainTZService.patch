From 11b3dc84a6c40a49090b615cd1b610f27c12babd Mon Sep 17 00:00:00 2001
From: Salvo Giangreco <giangrecosalvo9@gmail.com>
Date: Sat, 15 Nov 2025 14:11:10 +0100
Subject: [PATCH] Nuke BlockchainTZService

---
 ...temServer$$ExternalSyntheticLambda10.smali | 93 +++++++------------
 smali/com/android/server/SystemServer$5.smali | 35 +------
 2 files changed, 35 insertions(+), 93 deletions(-)

diff --git a/smali/com/android/server/SystemServer$$ExternalSyntheticLambda10.smali b/smali/com/android/server/SystemServer$$ExternalSyntheticLambda10.smali
index 6f20a3637..d4928cdc9 100644
--- a/smali/com/android/server/SystemServer$$ExternalSyntheticLambda10.smali
+++ b/smali/com/android/server/SystemServer$$ExternalSyntheticLambda10.smali
@@ -46,15 +46,11 @@
 
     move-result-object v2
 
-    const-string v3, "Blockchain Service"
+    const-string/jumbo v3, "SemAuthnrService"
 
     invoke-virtual {v2, v3}, Lcom/android/server/utils/TimingsTraceAndSlog;->traceBegin(Ljava/lang/String;)V
 
     :try_start_0
-    invoke-static {v1, v3}, Landroid/util/Slog;->i(Ljava/lang/String;Ljava/lang/String;)I
-
-    const-string/jumbo v3, "blockchain"
-
     new-instance v4, Lcom/android/server/SystemServer$5;
 
     const/4 v5, 0x5
@@ -68,63 +64,36 @@
     goto :goto_0
 
     :catchall_0
-    move-exception v3
-
-    const-string v4, "Failure starting Blockchain TZ Service"
-
-    invoke-static {v1, v4, v3}, Landroid/util/Slog;->e(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)I
-
-    :goto_0
-    invoke-virtual {v2}, Landroid/util/TimingsTraceLog;->traceEnd()V
-
-    const-string/jumbo v3, "SemAuthnrService"
-
-    invoke-virtual {v2, v3}, Lcom/android/server/utils/TimingsTraceAndSlog;->traceBegin(Ljava/lang/String;)V
-
-    :try_start_1
-    new-instance v4, Lcom/android/server/SystemServer$5;
-
-    const/4 v5, 0x6
-
-    invoke-direct {v4, v5}, Lcom/android/server/SystemServer$5;-><init>(I)V
-
-    invoke-static {v3, v4}, Landroid/os/ServiceManager;->addService(Ljava/lang/String;Landroid/os/IServiceCreator;)V
-    :try_end_1
-    .catchall {:try_start_1 .. :try_end_1} :catchall_1
-
-    goto :goto_1
-
-    :catchall_1
     const-string v3, "Failed to add SemAuthnrService."
 
     invoke-static {v1, v3}, Landroid/util/Slog;->e(Ljava/lang/String;Ljava/lang/String;)I
 
-    :goto_1
+    :goto_0
     invoke-virtual {v2}, Landroid/util/TimingsTraceLog;->traceEnd()V
 
     const-string/jumbo v3, "VideoTranscodingService"
 
     invoke-virtual {v2, v3}, Lcom/android/server/utils/TimingsTraceAndSlog;->traceBegin(Ljava/lang/String;)V
 
-    :try_start_2
+    :try_start_1
     const-string/jumbo v3, "SemVideoTranscodingService"
 
     const-class v4, Lcom/samsung/android/media/codec/VideoTranscodingService;
 
     invoke-static {v3, v4}, Landroid/os/ServiceManager;->addService(Ljava/lang/String;Ljava/lang/Class;)V
-    :try_end_2
-    .catchall {:try_start_2 .. :try_end_2} :catchall_2
+    :try_end_1
+    .catchall {:try_start_1 .. :try_end_1} :catchall_1
 
-    goto :goto_2
+    goto :goto_1
 
-    :catchall_2
+    :catchall_1
     move-exception v3
 
     const-string v4, "Failed to start VideoTranscodingService "
 
     invoke-static {v1, v4, v3}, Landroid/util/Slog;->e(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)I
 
-    :goto_2
+    :goto_1
     invoke-virtual {v2}, Landroid/util/TimingsTraceLog;->traceEnd()V
 
     const/4 v3, 0x0
@@ -137,23 +106,23 @@
 
     invoke-virtual {v2, p0}, Lcom/android/server/utils/TimingsTraceAndSlog;->traceBegin(Ljava/lang/String;)V
 
-    :try_start_3
+    :try_start_2
     const-string/jumbo v3, "dsms"
 
     const-class v4, Lcom/samsung/android/jdsms/DsmsService;
 
     invoke-static {v3, v4}, Landroid/os/ServiceManager;->addService(Ljava/lang/String;Ljava/lang/Class;)V
-    :try_end_3
-    .catchall {:try_start_3 .. :try_end_3} :catchall_3
+    :try_end_2
+    .catchall {:try_start_2 .. :try_end_2} :catchall_2
 
-    goto :goto_3
+    goto :goto_2
 
-    :catchall_3
+    :catchall_2
     move-exception v3
 
     invoke-static {p0, v3}, Lcom/android/server/SystemServer;->reportWtf(Ljava/lang/String;Ljava/lang/Throwable;)V
 
-    :goto_3
+    :goto_2
     invoke-virtual {v2}, Landroid/util/TimingsTraceLog;->traceEnd()V
 
     :cond_0
@@ -161,7 +130,7 @@
 
     invoke-virtual {v2, p0}, Lcom/android/server/utils/TimingsTraceAndSlog;->traceBegin(Ljava/lang/String;)V
 
-    :try_start_4
+    :try_start_3
     const-string/jumbo p0, "mpos_service"
 
     new-instance v3, Lcom/android/server/SystemServer$5;
@@ -169,10 +138,10 @@
     invoke-direct {v3, v0}, Lcom/android/server/SystemServer$5;-><init>(I)V
 
     invoke-static {p0, v3}, Landroid/os/ServiceManager;->addService(Ljava/lang/String;Landroid/os/IServiceCreator;)V
-    :try_end_4
-    .catch Ljava/lang/Exception; {:try_start_4 .. :try_end_4} :catch_0
+    :try_end_3
+    .catch Ljava/lang/Exception; {:try_start_3 .. :try_end_3} :catch_0
 
-    goto :goto_4
+    goto :goto_3
 
     :catch_0
     move-exception p0
@@ -183,14 +152,14 @@
 
     invoke-virtual {p0}, Ljava/lang/Exception;->printStackTrace()V
 
-    :goto_4
+    :goto_3
     invoke-virtual {v2}, Landroid/util/TimingsTraceLog;->traceEnd()V
 
     const-string p0, "Email Keystore Service"
 
     invoke-virtual {v2, p0}, Lcom/android/server/utils/TimingsTraceAndSlog;->traceBegin(Ljava/lang/String;)V
 
-    :try_start_5
+    :try_start_4
     invoke-static {v1, p0}, Landroid/util/Slog;->i(Ljava/lang/String;Ljava/lang/String;)I
 
     const-string/jumbo p0, "emailksproxy"
@@ -202,26 +171,26 @@
     invoke-direct {v0, v3}, Lcom/android/server/SystemServer$5;-><init>(I)V
 
     invoke-static {p0, v0}, Landroid/os/ServiceManager;->addService(Ljava/lang/String;Landroid/os/IServiceCreator;)V
-    :try_end_5
-    .catchall {:try_start_5 .. :try_end_5} :catchall_4
+    :try_end_4
+    .catchall {:try_start_4 .. :try_end_4} :catchall_3
 
-    goto :goto_5
+    goto :goto_4
 
-    :catchall_4
+    :catchall_3
     move-exception p0
 
     const-string v0, "Failure starting Email Keystore Service"
 
     invoke-static {v1, v0, p0}, Landroid/util/Slog;->e(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)I
 
-    :goto_5
+    :goto_4
     invoke-virtual {v2}, Landroid/util/TimingsTraceLog;->traceEnd()V
 
     const-string/jumbo p0, "SemSsdidManagerService"
 
     invoke-virtual {v2, p0}, Lcom/android/server/utils/TimingsTraceAndSlog;->traceBegin(Ljava/lang/String;)V
 
-    :try_start_6
+    :try_start_5
     const-string/jumbo p0, "sem_ssdid"
 
     new-instance v0, Lcom/android/server/SystemServer$$ExternalSyntheticLambda11;
@@ -229,19 +198,19 @@
     invoke-direct {v0}, Ljava/lang/Object;-><init>()V
 
     invoke-static {p0, v0}, Landroid/os/ServiceManager;->addService(Ljava/lang/String;Landroid/os/IServiceCreator;)V
-    :try_end_6
-    .catchall {:try_start_6 .. :try_end_6} :catchall_5
+    :try_end_5
+    .catchall {:try_start_5 .. :try_end_5} :catchall_4
 
-    goto :goto_6
+    goto :goto_5
 
-    :catchall_5
+    :catchall_4
     move-exception p0
 
     const-string v0, "Failure starting SemSsdidManagerService"
 
     invoke-static {v1, v0, p0}, Landroid/util/Slog;->e(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)I
 
-    :goto_6
+    :goto_5
     invoke-virtual {v2}, Landroid/util/TimingsTraceLog;->traceEnd()V
 
     return-void
diff --git a/smali/com/android/server/SystemServer$5.smali b/smali/com/android/server/SystemServer$5.smali
index 3c86dd672..52c4bc4b4 100644
--- a/smali/com/android/server/SystemServer$5.smali
+++ b/smali/com/android/server/SystemServer$5.smali
@@ -43,32 +43,6 @@
     return-object p0
 
     :pswitch_0
-    new-instance p0, Lcom/android/server/blockchain/BlockchainTZService;
-
-    invoke-direct {p0}, Landroid/blockchain/IBlockchainManager$Stub;-><init>()V
-
-    new-instance v0, Ljava/util/HashMap;
-
-    invoke-direct {v0}, Ljava/util/HashMap;-><init>()V
-
-    iput-object v0, p0, Lcom/android/server/blockchain/BlockchainTZService;->mRegisteredFWKClientMap:Ljava/util/Map;
-
-    sget-boolean v0, Lcom/android/server/blockchain/BlockchainTZService;->DEBUG:Z
-
-    if-eqz v0, :cond_0
-
-    const-string v0, "BlockchainTZService"
-
-    const-string v1, "BlockchainTZService() called"
-
-    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
-
-    :cond_0
-    sput-object p1, Lcom/android/server/blockchain/BlockchainTZService;->mContext:Landroid/content/Context;
-
-    return-object p0
-
-    :pswitch_1
     new-instance p0, Lcom/android/server/knox/dar/DarManagerService;
 
     new-instance v0, Lcom/android/server/knox/dar/DarManagerService$Injector;
@@ -79,14 +53,14 @@
 
     return-object p0
 
-    :pswitch_2
+    :pswitch_1
     new-instance p0, Lcom/android/server/enterprise/container/KnoxMUMRCPPolicyService;
 
     invoke-direct {p0, p1}, Lcom/android/server/enterprise/container/KnoxMUMRCPPolicyService;-><init>(Landroid/content/Context;)V
 
     return-object p0
 
-    :pswitch_3
+    :pswitch_2
     new-instance p0, Lcom/android/server/emailksproxy/EmailKeystoreService;
 
     invoke-direct {p0}, Lcom/samsung/android/knox/util/ISemKeyStoreService$Stub;-><init>()V
@@ -95,14 +69,14 @@
 
     return-object p0
 
-    :pswitch_4
+    :pswitch_3
     new-instance p0, Lcom/android/server/enterprise/mpos/MPOSService;
 
     invoke-direct {p0, p1}, Lcom/android/server/enterprise/mpos/MPOSService;-><init>(Landroid/content/Context;)V
 
     return-object p0
 
-    :pswitch_5
+    :pswitch_4
     new-instance p0, Lcom/android/server/IcccManagerService;
 
     invoke-direct {p0}, Lcom/samsung/android/iccc/IIntegrityControlCheckCenter$Stub;-><init>()V
@@ -137,7 +111,6 @@
 
     :pswitch_data_0
     .packed-switch 0x0
-        :pswitch_5
         :pswitch_4
         :pswitch_3
         :pswitch_2
-- 
2.51.2

