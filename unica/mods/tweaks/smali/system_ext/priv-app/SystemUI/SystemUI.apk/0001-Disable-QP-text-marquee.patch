From 93f258bdc5de60786a681a43fda1b413493eb473 Mon Sep 17 00:00:00 2001
From: Salvo Giangreco <giangrecosalvo9@gmail.com>
Date: Wed, 27 Aug 2025 01:15:03 +0200
Subject: [PATCH] Disable QP text marquee

---
 res/layout/keyguard_status_bar.xml                  |  2 +-
 res/layout/sec_qs_large_tile_label.xml              |  4 ++--
 res/layout/sec_qs_tile_label.xml                    |  4 ++--
 res/layout/sec_status_bar_notification_shelf.xml    |  4 ++--
 res/layout/shade_carrier.xml                        |  2 +-
 smali/com/android/keyguard/CarrierText.smali        |  9 ---------
 .../phone/SwitchableDoubleShadowTextView.smali      | 13 -------------
 7 files changed, 8 insertions(+), 30 deletions(-)

diff --git a/res/layout/keyguard_status_bar.xml b/res/layout/keyguard_status_bar.xml
index 1f4718f9f9..9b2e36bdd3 100644
--- a/res/layout/keyguard_status_bar.xml
+++ b/res/layout/keyguard_status_bar.xml
@@ -5,7 +5,7 @@
         <com.android.systemui.statusbar.phone.IndicatorGardenMaxWidthRelativeLayout android:gravity="center_vertical" android:id="@id/keyguard_left_container" android:layout_width="wrap_content" android:layout_height="match_parent" android:layout_alignParentStart="true">
             <LinearLayout android:orientation="horizontal" android:id="@id/keyguard_carrier_text_nio_container" android:layout_width="wrap_content" android:layout_height="match_parent">
                 <LinearLayout android:layout_width="0.0dp" android:layout_height="match_parent" android:layout_weight="1.0">
-                    <com.android.keyguard.CarrierText android:textAppearance="@style/TextAppearance.Keyguard.Status.SamsungCarriers" android:textColor="?wallpaperTextColorSecondary" android:ellipsize="marquee" android:gravity="center_vertical" android:id="@id/keyguard_carrier_text" android:paddingTop="@dimen/status_bar_padding_top" android:layout_width="match_parent" android:layout_height="match_parent" android:singleLine="true" android:includeFontPadding="false" android:layout_toStartOf="@id/system_icons_container" systemui:debugLocation="Keyguard" systemui:showAirplaneMode="true" systemui:showMissingSim="true" />
+                    <com.android.keyguard.CarrierText android:textAppearance="@style/TextAppearance.Keyguard.Status.SamsungCarriers" android:textColor="?wallpaperTextColorSecondary" android:ellipsize="end" android:gravity="center_vertical" android:id="@id/keyguard_carrier_text" android:paddingTop="@dimen/status_bar_padding_top" android:layout_width="match_parent" android:layout_height="match_parent" android:singleLine="true" android:includeFontPadding="false" android:layout_toStartOf="@id/system_icons_container" systemui:debugLocation="Keyguard" systemui:showAirplaneMode="true" systemui:showMissingSim="true" />
                 </LinearLayout>
                 <FrameLayout android:gravity="center_vertical" android:id="@id/keyguard_ongoing_call_chip" android:visibility="gone" android:layout_width="wrap_content" android:layout_height="match_parent" android:layout_marginStart="@dimen/samsung_ongoing_call_chip_keyguard_margin_start">
                     <include layout="@layout/samsung_ongoing_call_chip" />
diff --git a/res/layout/sec_qs_large_tile_label.xml b/res/layout/sec_qs_large_tile_label.xml
index 6a8bb0e3ca..ce4675f398 100644
--- a/res/layout/sec_qs_large_tile_label.xml
+++ b/res/layout/sec_qs_large_tile_label.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="utf-8"?>
 <LinearLayout android:gravity="center" android:orientation="vertical" android:id="@id/label_group" android:clipChildren="false" android:clipToPadding="false" android:layout_width="match_parent" android:layout_height="match_parent" android:layout_weight="1.0" android:layout_alignParentTop="true" android:paddingEnd="@dimen/large_tile_label_margin_end"
   xmlns:android="http://schemas.android.com/apk/res/android">
-    <TextView android:textSize="@dimen/sec_style_qs_tile_text_size" android:textColor="@color/qs_tile_label" android:ellipsize="marquee" android:gravity="start" android:layout_gravity="center" android:id="@id/tile_label" android:clickable="false" android:layout_width="match_parent" android:layout_height="wrap_content" android:fontFamily="sec" android:textAlignment="viewStart" android:layoutDirection="locale" android:textFontWeight="600" />
-    <com.android.systemui.util.AppLabelTextView android:textSize="@dimen/sec_style_qs_tile_second_text_size" android:textColor="@color/qs_tile_sub_label" android:ellipsize="marquee" android:gravity="start" android:layout_gravity="center" android:id="@id/app_label" android:visibility="gone" android:clickable="false" android:layout_width="match_parent" android:layout_height="wrap_content" android:singleLine="true" android:layout_below="@id/label_group" android:fontFamily="sec" android:layoutDirection="locale" android:layout_alignStart="@id/label_group" android:layout_alignEnd="@id/label_group" android:textFontWeight="400" />
+    <TextView android:textSize="@dimen/sec_style_qs_tile_text_size" android:textColor="@color/qs_tile_label" android:ellipsize="end" android:gravity="start" android:layout_gravity="center" android:id="@id/tile_label" android:clickable="false" android:layout_width="match_parent" android:layout_height="wrap_content" android:fontFamily="sec" android:textAlignment="viewStart" android:layoutDirection="locale" android:textFontWeight="600" />
+    <com.android.systemui.util.AppLabelTextView android:textSize="@dimen/sec_style_qs_tile_second_text_size" android:textColor="@color/qs_tile_sub_label" android:ellipsize="end" android:gravity="start" android:layout_gravity="center" android:id="@id/app_label" android:visibility="gone" android:clickable="false" android:layout_width="match_parent" android:layout_height="wrap_content" android:singleLine="true" android:layout_below="@id/label_group" android:fontFamily="sec" android:layoutDirection="locale" android:layout_alignStart="@id/label_group" android:layout_alignEnd="@id/label_group" android:textFontWeight="400" />
 </LinearLayout>
diff --git a/res/layout/sec_qs_tile_label.xml b/res/layout/sec_qs_tile_label.xml
index a61abdfbde..4e63b29564 100644
--- a/res/layout/sec_qs_tile_label.xml
+++ b/res/layout/sec_qs_tile_label.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="utf-8"?>
 <LinearLayout android:gravity="top" android:orientation="vertical" android:id="@id/label_group" android:clipChildren="false" android:clipToPadding="false" android:layout_width="match_parent" android:layout_height="match_parent" android:layout_alignParentTop="true" android:importantForAccessibility="no" android:paddingStart="@dimen/tile_label_margin" android:paddingEnd="@dimen/tile_label_margin"
   xmlns:android="http://schemas.android.com/apk/res/android">
-    <TextView android:textSize="@dimen/sec_qs_tile_label_text_size" android:textColor="@color/qs_tile_label" android:ellipsize="marquee" android:gravity="center_horizontal" android:layout_gravity="center" android:id="@id/tile_label" android:padding="@dimen/sec_style_qs_tile_label_padding" android:clickable="false" android:layout_width="match_parent" android:layout_height="wrap_content" android:importantForAccessibility="no" android:fontFamily="sec" android:textFontWeight="500" />
-    <TextView android:textSize="@dimen/sec_qs_tile_label_text_size" android:textColor="@color/qs_tile_sub_label" android:ellipsize="marquee" android:gravity="center_horizontal" android:layout_gravity="center" android:id="@id/app_label" android:padding="@dimen/sec_style_qs_tile_label_padding" android:visibility="gone" android:clickable="false" android:layout_width="match_parent" android:layout_height="wrap_content" android:singleLine="true" android:layout_below="@id/label_group" android:importantForAccessibility="no" android:fontFamily="sec" android:layout_alignStart="@id/label_group" android:layout_alignEnd="@id/label_group" android:textFontWeight="400" />
+    <TextView android:textSize="@dimen/sec_qs_tile_label_text_size" android:textColor="@color/qs_tile_label" android:ellipsize="end" android:gravity="center_horizontal" android:layout_gravity="center" android:id="@id/tile_label" android:padding="@dimen/sec_style_qs_tile_label_padding" android:clickable="false" android:layout_width="match_parent" android:layout_height="wrap_content" android:importantForAccessibility="no" android:fontFamily="sec" android:textFontWeight="500" />
+    <TextView android:textSize="@dimen/sec_qs_tile_label_text_size" android:textColor="@color/qs_tile_sub_label" android:ellipsize="end" android:gravity="center_horizontal" android:layout_gravity="center" android:id="@id/app_label" android:padding="@dimen/sec_style_qs_tile_label_padding" android:visibility="gone" android:clickable="false" android:layout_width="match_parent" android:layout_height="wrap_content" android:singleLine="true" android:layout_below="@id/label_group" android:importantForAccessibility="no" android:fontFamily="sec" android:layout_alignStart="@id/label_group" android:layout_alignEnd="@id/label_group" android:textFontWeight="400" />
 </LinearLayout>
diff --git a/res/layout/sec_status_bar_notification_shelf.xml b/res/layout/sec_status_bar_notification_shelf.xml
index eecb54887b..fc2495b21c 100644
--- a/res/layout/sec_status_bar_notification_shelf.xml
+++ b/res/layout/sec_status_bar_notification_shelf.xml
@@ -6,11 +6,11 @@
     <LinearLayout android:orientation="vertical" android:layout_width="match_parent" android:layout_height="match_parent">
         <LinearLayout android:gravity="center_vertical" android:orientation="horizontal" android:id="@id/notification_shelf_text_area" android:paddingTop="@dimen/sec_notification_shelf_text_area_top_padding" android:paddingBottom="@dimen/sec_notification_shelf_text_area_bottom_padding_with_button_nav" android:focusable="true" android:descendantFocusability="afterDescendants" android:layout_width="match_parent" android:layout_height="match_parent">
             <LinearLayout android:gravity="start" android:layout_width="0.0dp" android:layout_height="match_parent" android:layout_weight="0.48">
-                <com.android.systemui.animation.view.LaunchableTextView android:ellipsize="marquee" android:id="@id/noti_setting" android:visibility="visible" android:layout_width="wrap_content" android:layout_height="match_parent" android:text="@string/noti_setting_text" android:marqueeRepeatLimit="3" style="@style/TextAppearance.NotificationShelf" />
+                <com.android.systemui.animation.view.LaunchableTextView android:ellipsize="end" android:id="@id/noti_setting" android:visibility="visible" android:layout_width="wrap_content" android:layout_height="match_parent" android:text="@string/noti_setting_text" style="@style/TextAppearance.NotificationShelf" />
             </LinearLayout>
             <Space android:layout_width="0.0dp" android:layout_height="match_parent" android:layout_weight="0.04" />
             <LinearLayout android:gravity="end" android:layout_width="0.0dp" android:layout_height="match_parent" android:layout_weight="0.48">
-                <com.android.systemui.animation.view.LaunchableTextView android:ellipsize="marquee" android:id="@id/clear_all" android:visibility="visible" android:layout_width="wrap_content" android:layout_height="match_parent" android:text="@string/clear_all_text" android:marqueeRepeatLimit="3" style="@style/TextAppearance.NotificationShelf" />
+                <com.android.systemui.animation.view.LaunchableTextView android:ellipsize="end" android:id="@id/clear_all" android:visibility="visible" android:layout_width="wrap_content" android:layout_height="match_parent" android:text="@string/clear_all_text" style="@style/TextAppearance.NotificationShelf" />
             </LinearLayout>
         </LinearLayout>
         <ViewStub android:layout_gravity="center" android:id="@id/sec_panel_data_usage_container_stub" android:layout="@layout/sec_panel_data_usage_container" android:layout_width="match_parent" android:layout_height="wrap_content" />
diff --git a/res/layout/shade_carrier.xml b/res/layout/shade_carrier.xml
index fbc389b453..7a7f4f9b13 100644
--- a/res/layout/shade_carrier.xml
+++ b/res/layout/shade_carrier.xml
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="utf-8"?>
 <com.android.systemui.shade.carrier.ShadeCarrier android:gravity="start|center" android:orientation="horizontal" android:id="@id/linear_carrier" android:background="@android:color/transparent" android:focusable="true" android:clickable="false" android:clipChildren="false" android:clipToPadding="false" android:layout_width="wrap_content" android:layout_height="match_parent" android:minWidth="48.0dp" android:layout_marginEnd="@dimen/shade_carrier_margin_end"
   xmlns:android="http://schemas.android.com/apk/res/android" xmlns:app="http://schemas.android.com/apk/res-auto">
-    <com.android.systemui.statusbar.phone.SwitchableDoubleShadowTextView android:textAppearance="@style/TextAppearance.QS.Status.SamsungCarriers" android:ellipsize="marquee" android:id="@id/shade_carrier_text" android:clipChildren="false" android:clipToPadding="false" android:layout_width="wrap_content" android:layout_height="wrap_content" android:singleLine="true" android:includeFontPadding="false" android:layout_weight="1.0" app:ambientShadowAlpha="0.0" app:ambientShadowBlur="@dimen/shadow_radius" app:ambientShadowOffsetX="@dimen/shadow_difference" app:ambientShadowOffsetY="@dimen/shadow_difference" app:keyShadowAlpha="0.2" app:keyShadowBlur="@dimen/shadow_radius" app:keyShadowOffsetX="@dimen/shadow_difference" app:keyShadowOffsetY="@dimen/shadow_difference" />
+    <com.android.systemui.statusbar.phone.SwitchableDoubleShadowTextView android:textAppearance="@style/TextAppearance.QS.Status.SamsungCarriers" android:ellipsize="end" android:id="@id/shade_carrier_text" android:clipChildren="false" android:clipToPadding="false" android:layout_width="wrap_content" android:layout_height="wrap_content" android:singleLine="true" android:includeFontPadding="false" android:layout_weight="1.0" app:ambientShadowAlpha="0.0" app:ambientShadowBlur="@dimen/shadow_radius" app:ambientShadowOffsetX="@dimen/shadow_difference" app:ambientShadowOffsetY="@dimen/shadow_difference" app:keyShadowAlpha="0.2" app:keyShadowBlur="@dimen/shadow_radius" app:keyShadowOffsetX="@dimen/shadow_difference" app:keyShadowOffsetY="@dimen/shadow_difference" />
     <View android:id="@id/spacer" android:visibility="gone" android:layout_width="@dimen/qs_carrier_margin_width" android:layout_height="match_parent" />
     <include android:visibility="gone" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_marginStart="@dimen/qs_carrier_margin_width" layout="@layout/mobile_signal_group" />
 </com.android.systemui.shade.carrier.ShadeCarrier>
diff --git a/smali/com/android/keyguard/CarrierText.smali b/smali/com/android/keyguard/CarrierText.smali
index 946d85782c..6db099210f 100644
--- a/smali/com/android/keyguard/CarrierText.smali
+++ b/smali/com/android/keyguard/CarrierText.smali
@@ -115,15 +115,6 @@
 
     invoke-super {p0, p1, p2}, Landroid/widget/TextView;->onVisibilityChanged(Landroid/view/View;I)V
 
-    if-nez p2, :cond_0
-
-    sget-object p1, Landroid/text/TextUtils$TruncateAt;->MARQUEE:Landroid/text/TextUtils$TruncateAt;
-
-    invoke-virtual {p0, p1}, Landroid/widget/TextView;->setEllipsize(Landroid/text/TextUtils$TruncateAt;)V
-
-    return-void
-
-    :cond_0
     sget-object p1, Landroid/text/TextUtils$TruncateAt;->END:Landroid/text/TextUtils$TruncateAt;
 
     invoke-virtual {p0, p1}, Landroid/widget/TextView;->setEllipsize(Landroid/text/TextUtils$TruncateAt;)V
diff --git a/smali_classes3/com/android/systemui/statusbar/phone/SwitchableDoubleShadowTextView.smali b/smali_classes3/com/android/systemui/statusbar/phone/SwitchableDoubleShadowTextView.smali
index d8ba3e9a54..45f80dbfcf 100644
--- a/smali_classes3/com/android/systemui/statusbar/phone/SwitchableDoubleShadowTextView.smali
+++ b/smali_classes3/com/android/systemui/statusbar/phone/SwitchableDoubleShadowTextView.smali
@@ -321,19 +321,6 @@
     :cond_0
     iput-boolean p1, p0, Lcom/android/systemui/statusbar/phone/SwitchableDoubleShadowTextView;->aggregatedVisible:Z
 
-    if-eqz p1, :cond_1
-
-    sget-object p1, Landroid/text/TextUtils$TruncateAt;->MARQUEE:Landroid/text/TextUtils$TruncateAt;
-
-    invoke-virtual {p0, p1}, Landroid/widget/TextView;->setEllipsize(Landroid/text/TextUtils$TruncateAt;)V
-
-    const/4 p1, 0x1
-
-    invoke-virtual {p0, p1}, Landroid/widget/TextView;->setSelected(Z)V
-
-    return-void
-
-    :cond_1
     sget-object p1, Landroid/text/TextUtils$TruncateAt;->END:Landroid/text/TextUtils$TruncateAt;
 
     invoke-virtual {p0, p1}, Landroid/widget/TextView;->setEllipsize(Landroid/text/TextUtils$TruncateAt;)V
-- 
2.51.1

