From ac0f6eee59ec999f7eb5c8fe30fdef30f18c5583 Mon Sep 17 00:00:00 2001
From: Salvo Giangreco <giangrecosalvo9@gmail.com>
Date: Fri, 24 Oct 2025 14:45:06 +0200
Subject: [PATCH] Allow app downgrade

---
 .../server/pm/PackageManagerService.smali        | 16 ++++++++++++++++
 1 file changed, 16 insertions(+)

diff --git a/smali_classes2/com/android/server/pm/PackageManagerService.smali b/smali_classes2/com/android/server/pm/PackageManagerService.smali
index 773266ffc..eb0880764 100644
--- a/smali_classes2/com/android/server/pm/PackageManagerService.smali
+++ b/smali_classes2/com/android/server/pm/PackageManagerService.smali
@@ -22001,6 +22001,22 @@
 
     if-nez v0, :cond_b
 
+    iget-object v0, v2, Lcom/android/server/pm/InstallPackageHelper;->mContext:Landroid/content/Context;
+
+    invoke-virtual {v0}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object v0
+
+    const-string v3, "unica_allow_downgrade"
+
+    const/4 v4, 0x0
+
+    invoke-static {v0, v3, v4}, Landroid/provider/Settings$System;->getInt(Landroid/content/ContentResolver;Ljava/lang/String;I)I
+
+    move-result v0
+
+    if-nez v0, :cond_b
+
     :try_start_3
     invoke-interface {v10}, Lcom/android/server/pm/pkg/AndroidPackage;->getLongVersionCode()J
 
-- 
2.51.1

