From dc1db57e25b53d46c0d4e6be0f66834a688eb98d Mon Sep 17 00:00:00 2001
From: Salvo Giangreco <giangrecosalvo9@gmail.com>
Date: Thu, 28 Aug 2025 18:58:51 +0200
Subject: [PATCH] Add optical FOD support

---
 .../keyguard/KeyguardSecUpdateMonitor.smali   |   6 +
 ...onitorImpl$$ExternalSyntheticLambda9.smali |  14 +-
 .../KeyguardSecUpdateMonitorImpl.smali        | 344 ++++++++++++---
 smali/com/android/systemui/LsRune.smali       |   4 +
 .../features/GlobalActionFeatures.smali       |   8 +-
 .../KeyguardFastBioUnlockController.smali     |  27 ++
 ...llerImpl$playCannedUnlockAnimation$6.smali |  35 +-
 .../keyguard/KeyguardViewMediator.smali       |  15 +-
 .../KeyguardViewMediatorHelperImpl.smali      | 407 +++++++++---------
 ...ationShadeWindowControllerHelperImpl.smali |  25 +-
 .../statusbar/phone/CentralSurfacesImpl.smali |  95 ++--
 .../android/systemui/util/DeviceState.smali   |  36 +-
 .../android/systemui/util/DeviceType.smali    |  12 +-
 13 files changed, 671 insertions(+), 357 deletions(-)

diff --git a/smali/com/android/keyguard/KeyguardSecUpdateMonitor.smali b/smali/com/android/keyguard/KeyguardSecUpdateMonitor.smali
index 2865f30d1..0cb5a8b25 100644
--- a/smali/com/android/keyguard/KeyguardSecUpdateMonitor.smali
+++ b/smali/com/android/keyguard/KeyguardSecUpdateMonitor.smali
@@ -858,6 +858,12 @@
     return-void
 .end method
 
+.method public removeMaskViewForOpticalFpSensor()V
+    .locals 0
+
+    return-void
+.end method
+
 .method public requestSessionClose()V
     .locals 0
 
diff --git a/smali/com/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda9.smali b/smali/com/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda9.smali
index af35f3d71..d88929d73 100644
--- a/smali/com/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda9.smali
+++ b/smali/com/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda9.smali
@@ -28,21 +28,15 @@
 
 # virtual methods
 .method public final onChanged(Landroid/net/Uri;)V
-    .locals 1
+    .locals 0
 
     iget-object p1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda9;->f$0:Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;
 
-    const/4 v0, 0x2
-
     iget p0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda9;->$r8$classId:I
 
     packed-switch p0, :pswitch_data_0
 
-    sget-object p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->sFaceManager:Lcom/samsung/android/bio/face/SemBioFaceManager;
-
-    invoke-virtual {p1, v0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->updateFingerprintListeningState(I)V
-
-    sget-object p0, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    invoke-static {p1}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->$r8$lambda$kJTDZ_s3Y5_-kkqejQUfg2hm3D0(Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;)V
 
     return-void
 
@@ -70,7 +64,9 @@
 
     if-eqz p0, :cond_1
 
-    invoke-virtual {p1, v0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->updateFingerprintListeningState(I)V
+    const/4 p0, 0x2
+
+    invoke-virtual {p1, p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->updateFingerprintListeningState(I)V
 
     :cond_1
     return-void
diff --git a/smali/com/android/keyguard/KeyguardSecUpdateMonitorImpl.smali b/smali/com/android/keyguard/KeyguardSecUpdateMonitorImpl.smali
index 24a4ad53e..15f2ec11e 100644
--- a/smali/com/android/keyguard/KeyguardSecUpdateMonitorImpl.smali
+++ b/smali/com/android/keyguard/KeyguardSecUpdateMonitorImpl.smali
@@ -86,7 +86,7 @@
 
 .field public mFpInDisplayState:I
 
-.field public final mFpMaskToken:Landroid/os/IBinder;
+.field public mFpMaskToken:Landroid/os/IBinder;
 
 .field public final mFpMessages:Ljava/util/concurrent/ConcurrentLinkedQueue;
 
@@ -264,6 +264,46 @@
     return-void
 .end method
 
+.method public static $r8$lambda$kJTDZ_s3Y5_-kkqejQUfg2hm3D0(Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;)V
+    .locals 1
+
+    const/4 v0, 0x2
+
+    invoke-virtual {p0, v0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->updateFingerprintListeningState(I)V
+
+    sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz v0, :cond_1
+
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mSettingsHelper:Lcom/android/systemui/util/SettingsHelper;
+
+    invoke-virtual {v0}, Lcom/android/systemui/util/SettingsHelper;->isOneHandModeRunning()Z
+
+    move-result v0
+
+    if-eqz v0, :cond_0
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->removeMaskViewForOpticalFpSensor()V
+
+    return-void
+
+    :cond_0
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardUpdateMonitor;->isFingerprintDetectionRunning()Z
+
+    move-result v0
+
+    if-eqz v0, :cond_1
+
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpMaskToken:Landroid/os/IBinder;
+
+    if-nez v0, :cond_1
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->addMaskViewForOpticalFpSensor()V
+
+    :cond_1
+    return-void
+.end method
+
 .method public static bridge synthetic -$$Nest$fgetmSettingsHelper(Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;)Lcom/android/systemui/util/SettingsHelper;
     .locals 0
 
@@ -1096,6 +1136,41 @@
     return-void
 .end method
 
+.method public final addMaskViewForOpticalFpSensor()V
+    .locals 2
+
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpm:Landroid/hardware/fingerprint/FingerprintManager;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpMaskToken:Landroid/os/IBinder;
+
+    if-nez v0, :cond_0
+
+    const-string v0, "KeyguardFingerprint"
+
+    const-string v1, "semAddMaskView()"
+
+    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
+
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpm:Landroid/hardware/fingerprint/FingerprintManager;
+
+    invoke-virtual {v0}, Landroid/hardware/fingerprint/FingerprintManager;->semAddMaskView()Landroid/os/IBinder;
+
+    move-result-object v0
+
+    iput-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpMaskToken:Landroid/os/IBinder;
+
+    const/4 v0, 0x1
+
+    const/4 v1, 0x3
+
+    invoke-virtual {p0, v1, v0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->setFocusForBiometrics(IZ)V
+
+    :cond_0
+    return-void
+.end method
+
 .method public final checkValidPrevCredentialType()Z
     .locals 2
 
@@ -4878,60 +4953,67 @@
 .method public final handleFaceAuthenticated(IZ)V
     .locals 3
 
-    const/4 v0, 0x0
-
-    iget-object v1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mSettingsHelper:Lcom/android/systemui/util/SettingsHelper;
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mSettingsHelper:Lcom/android/systemui/util/SettingsHelper;
 
-    invoke-virtual {v1}, Lcom/android/systemui/util/SettingsHelper;->isEnabledFaceStayOnLock()Z
+    invoke-virtual {v0}, Lcom/android/systemui/util/SettingsHelper;->isEnabledFaceStayOnLock()Z
 
-    move-result v1
+    move-result v0
 
-    if-eqz v1, :cond_0
+    if-eqz v0, :cond_0
 
-    iget-object v1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mBiometricFailedAttempts:Landroid/util/SparseIntArray;
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mBiometricFailedAttempts:Landroid/util/SparseIntArray;
 
-    iget-object v2, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mUserTracker:Lcom/android/systemui/settings/UserTracker;
+    iget-object v1, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mUserTracker:Lcom/android/systemui/settings/UserTracker;
 
-    check-cast v2, Lcom/android/systemui/settings/UserTrackerImpl;
+    check-cast v1, Lcom/android/systemui/settings/UserTrackerImpl;
 
-    invoke-virtual {v2}, Lcom/android/systemui/settings/UserTrackerImpl;->getUserId()I
+    invoke-virtual {v1}, Lcom/android/systemui/settings/UserTrackerImpl;->getUserId()I
 
-    move-result v2
+    move-result v1
 
-    invoke-virtual {v1, v2}, Landroid/util/SparseIntArray;->delete(I)V
+    invoke-virtual {v0, v1}, Landroid/util/SparseIntArray;->delete(I)V
 
     goto :goto_0
 
     :cond_0
-    sget-object v1, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz v0, :cond_1
 
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->removeMaskViewForOpticalFpSensor()V
+
+    :cond_1
     :goto_0
-    sget-boolean v1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY:Z
+    sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY:Z
 
-    if-eqz v1, :cond_1
+    if-eqz v0, :cond_2
 
-    iget v1, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mFingerprintRunningState:I
+    iget v0, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mFingerprintRunningState:I
 
-    const/4 v2, 0x1
+    const/4 v1, 0x1
 
-    if-ne v1, v2, :cond_1
+    if-ne v0, v1, :cond_2
 
-    const-string v1, "KeyguardFingerprint"
+    const-string v0, "KeyguardFingerprint"
 
-    const-string v2, "Face onAuthenticationSucceeded. FP will be stop!"
+    const-string v1, "Face onAuthenticationSucceeded. FP will be stop!"
 
-    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
+    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
 
     invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->stopListeningForFingerprint()V
 
-    :cond_1
-    new-instance v1, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda40;
+    :cond_2
+    new-instance v0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda40;
+
+    const/4 v1, 0x0
 
-    invoke-direct {v1, v0, p2, p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda40;-><init>(IZLjava/lang/Object;)V
+    invoke-direct {v0, v1, p2, p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda40;-><init>(IZLjava/lang/Object;)V
 
-    const-string v2, "onBiometricAuthenticated"
+    const-string v1, "onBiometricAuthenticated"
 
-    invoke-virtual {p0, v1, v2}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->dispatchCallback(Ljava/util/function/Consumer;Ljava/lang/String;)V
+    invoke-virtual {p0, v0, v1}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->dispatchCallback(Ljava/util/function/Consumer;Ljava/lang/String;)V
+
+    const/4 v0, 0x0
 
     invoke-virtual {p0, v0}, Lcom/android/keyguard/KeyguardUpdateMonitor;->setFaceRunningState(I)V
 
@@ -4945,11 +5027,11 @@
 
     sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_SUB_DISPLAY_COVER:Z
 
-    if-eqz p1, :cond_2
+    if-eqz p1, :cond_3
 
     iput-boolean v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mNeedSubBioAuth:Z
 
-    :cond_2
+    :cond_3
     return-void
 .end method
 
@@ -5275,9 +5357,33 @@
 .method public final handleFingerprintAuthenticated(IZ)V
     .locals 1
 
+    sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz v0, :cond_1
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->is2StepVerification()Z
+
+    move-result v0
+
+    if-nez v0, :cond_0
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->isForcedLock()Z
+
+    move-result v0
+
+    if-nez v0, :cond_0
+
+    iget-boolean v0, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mKeyguardShowing:Z
+
+    if-nez v0, :cond_1
+
+    :cond_0
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->removeMaskViewForOpticalFpSensor()V
+
+    :cond_1
     sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_SUB_DISPLAY_COVER:Z
 
-    if-eqz v0, :cond_0
+    if-eqz v0, :cond_2
 
     const/4 v0, 0x0
 
@@ -5287,7 +5393,7 @@
 
     iput-boolean v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mNeedSubWofFpAuth:Z
 
-    :cond_0
+    :cond_2
     invoke-super {p0, p1, p2}, Lcom/android/keyguard/KeyguardUpdateMonitor;->handleFingerprintAuthenticated(IZ)V
 
     return-void
@@ -5343,7 +5449,7 @@
     :cond_2
     const/16 v0, 0x3ea
 
-    if-eq v0, p1, :cond_5
+    if-eq v0, p1, :cond_6
 
     const/16 v0, 0x3eb
 
@@ -5354,13 +5460,15 @@
     :cond_3
     const/16 v0, 0x3e9
 
-    if-ne v0, p1, :cond_4
+    if-ne v0, p1, :cond_5
+
+    sget-boolean p2, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
 
-    sget-object p2, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    if-eqz p2, :cond_4
 
     iget-object p2, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mContext:Landroid/content/Context;
 
-    const v0, 0x7f1309cb
+    const v0, 0x7f1309c8
 
     invoke-virtual {p2, v0}, Landroid/content/Context;->getString(I)Ljava/lang/String;
 
@@ -5369,9 +5477,20 @@
     goto :goto_1
 
     :cond_4
+    iget-object p2, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mContext:Landroid/content/Context;
+
+    const v0, 0x7f1309cb
+
+    invoke-virtual {p2, v0}, Landroid/content/Context;->getString(I)Ljava/lang/String;
+
+    move-result-object p2
+
+    goto :goto_1
+
+    :cond_5
     const/16 v0, 0x3ed
 
-    if-ne v0, p1, :cond_6
+    if-ne v0, p1, :cond_7
 
     iget-object p2, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mContext:Landroid/content/Context;
 
@@ -5383,7 +5502,7 @@
 
     goto :goto_1
 
-    :cond_5
+    :cond_6
     :goto_0
     iget-object p2, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mContext:Landroid/content/Context;
 
@@ -5393,7 +5512,7 @@
 
     move-result-object p2
 
-    :cond_6
+    :cond_7
     :goto_1
     iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mPowerManager:Landroid/os/PowerManager;
 
@@ -5407,21 +5526,21 @@
 
     sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_BACKGROUND_AUTHENTICATION:Z
 
-    if-eqz v0, :cond_7
+    if-eqz v0, :cond_8
 
     const/4 v0, 0x5
 
-    if-ne p1, v0, :cond_7
+    if-ne p1, v0, :cond_8
 
     iget-boolean v0, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mKeyguardOccluded:Z
 
-    if-eqz v0, :cond_7
+    if-eqz v0, :cond_8
 
     iget v0, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mFingerprintRunningState:I
 
     const/4 v3, 0x1
 
-    if-ne v0, v3, :cond_7
+    if-ne v0, v3, :cond_8
 
     const-string v0, "mIsFPCanceledByForegroundApp true"
 
@@ -5431,7 +5550,7 @@
 
     invoke-virtual {p0, v1}, Lcom/android/keyguard/KeyguardUpdateMonitor;->setFingerprintRunningState(I)V
 
-    :cond_7
+    :cond_8
     invoke-super {p0, p1, p2}, Lcom/android/keyguard/KeyguardUpdateMonitor;->handleFingerprintError(ILjava/lang/String;)V
 
     return-void
@@ -12217,6 +12336,37 @@
     return-void
 .end method
 
+.method public final removeMaskViewForOpticalFpSensor()V
+    .locals 2
+
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpm:Landroid/hardware/fingerprint/FingerprintManager;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpMaskToken:Landroid/os/IBinder;
+
+    if-eqz v0, :cond_0
+
+    const-string v0, "KeyguardFingerprint"
+
+    const-string v1, "semRemoveMaskView()"
+
+    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
+
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpm:Landroid/hardware/fingerprint/FingerprintManager;
+
+    iget-object v1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpMaskToken:Landroid/os/IBinder;
+
+    invoke-virtual {v0, v1}, Landroid/hardware/fingerprint/FingerprintManager;->semRemoveMaskView(Landroid/os/IBinder;)I
+
+    const/4 v0, 0x0
+
+    iput-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpMaskToken:Landroid/os/IBinder;
+
+    :cond_0
+    return-void
+.end method
+
 .method public final reportFailedBiometricUnlockAttempt(I)V
     .locals 9
 
@@ -12368,7 +12518,7 @@
 
     move-result v0
 
-    if-eqz v0, :cond_1
+    if-eqz v0, :cond_2
 
     new-instance v0, Ljava/lang/StringBuilder;
 
@@ -12394,18 +12544,23 @@
 
     move-result v0
 
+    if-eqz v0, :cond_1
+
+    sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
     if-eqz v0, :cond_0
 
-    sget-object v0, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->removeMaskViewForOpticalFpSensor()V
 
+    :cond_0
     invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->stopListeningForFingerprint()V
 
     goto :goto_0
 
-    :cond_0
+    :cond_1
     iget-object v0, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mFingerprintCancelSignal:Landroid/os/CancellationSignal;
 
-    if-eqz v0, :cond_1
+    if-eqz v0, :cond_2
 
     invoke-virtual {v0}, Landroid/os/CancellationSignal;->cancel()V
 
@@ -12413,7 +12568,7 @@
 
     iput-object v0, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mFingerprintCancelSignal:Landroid/os/CancellationSignal;
 
-    :cond_1
+    :cond_2
     :goto_0
     sget-object v0, Lcom/android/systemui/Dependency;->sDependency:Lcom/android/systemui/Dependency;
 
@@ -13859,7 +14014,7 @@
 
     iput-boolean p1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mKeyguardUnlocking:Z
 
-    if-eqz p1, :cond_1
+    if-eqz p1, :cond_2
 
     invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->stopListeningForFingerprint()V
 
@@ -13867,8 +14022,13 @@
 
     invoke-virtual {p0, p1}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->stopListeningForFace(Lcom/android/systemui/deviceentry/shared/FaceAuthUiEvent;)V
 
-    sget-object p1, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz p1, :cond_1
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->removeMaskViewForOpticalFpSensor()V
 
+    :cond_1
     new-instance p1, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda15;
 
     const/4 v0, 0x2
@@ -13879,7 +14039,7 @@
 
     invoke-virtual {p0, p1, v0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->dispatchCallback(Ljava/util/function/Consumer;Ljava/lang/String;)V
 
-    :cond_1
+    :cond_2
     :goto_0
     return-void
 .end method
@@ -17276,9 +17436,9 @@
 
     invoke-static {v5, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
 
-    if-eqz v2, :cond_3
+    if-eqz v2, :cond_4
 
-    if-nez v1, :cond_3
+    if-nez v1, :cond_4
 
     if-nez p1, :cond_2
 
@@ -17287,48 +17447,94 @@
     :cond_2
     iget p1, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mFingerprintRunningState:I
 
-    if-ne p1, v3, :cond_6
+    if-ne p1, v3, :cond_8
+
+    sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz p1, :cond_3
+
+    iget-boolean p1, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mKeyguardShowing:Z
+
+    if-nez p1, :cond_3
 
-    sget-object p1, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->removeMaskViewForOpticalFpSensor()V
 
+    :cond_3
     invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->stopListeningForFingerprint()V
 
     goto :goto_2
 
-    :cond_3
-    if-nez v2, :cond_5
+    :cond_4
+    if-nez v2, :cond_7
 
-    if-eqz v1, :cond_5
+    if-eqz v1, :cond_7
 
-    if-ne p1, v3, :cond_4
+    if-ne p1, v3, :cond_5
 
     goto :goto_3
 
-    :cond_4
-    sget-object p1, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    :cond_5
+    sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz p1, :cond_6
+
+    iget-object p1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mSettingsHelper:Lcom/android/systemui/util/SettingsHelper;
+
+    invoke-virtual {p1}, Lcom/android/systemui/util/SettingsHelper;->isOneHandModeRunning()Z
+
+    move-result p1
+
+    if-nez p1, :cond_6
 
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->addMaskViewForOpticalFpSensor()V
+
+    :cond_6
     invoke-virtual {p0, v0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->startListeningForFingerprint(Z)V
 
     goto :goto_2
 
-    :cond_5
-    if-nez v2, :cond_6
+    :cond_7
+    if-nez v2, :cond_8
 
-    if-nez v1, :cond_6
+    if-nez v1, :cond_8
 
-    sget-object p1, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
 
-    :cond_6
+    if-eqz p1, :cond_8
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->isFingerprintOptionEnabled()Z
+
+    move-result p1
+
+    if-eqz p1, :cond_8
+
+    sget-boolean p1, Lcom/android/systemui/LsRune;->COVER_SUPPORTED:Z
+
+    if-eqz p1, :cond_8
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->isCoverClosed()Z
+
+    move-result p1
+
+    if-eqz p1, :cond_8
+
+    iget-boolean p1, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mKeyguardShowing:Z
+
+    if-eqz p1, :cond_8
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->addMaskViewForOpticalFpSensor()V
+
+    :cond_8
     :goto_2
     sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY:Z
 
-    if-eqz p1, :cond_7
+    if-eqz p1, :cond_9
 
-    if-eqz v1, :cond_7
+    if-eqz v1, :cond_9
 
     invoke-virtual {p0, v0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->sendScreenStatus(Z)V
 
-    :cond_7
+    :cond_9
     :goto_3
     return-void
 .end method
diff --git a/smali/com/android/systemui/LsRune.smali b/smali/com/android/systemui/LsRune.smali
index 08143bd82..86afc7e6b 100644
--- a/smali/com/android/systemui/LsRune.smali
+++ b/smali/com/android/systemui/LsRune.smali
@@ -130,6 +130,8 @@
 
 .field public static final SECURITY_FINGERPRINT_IN_DISPLAY:Z
 
+.field public static final SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
 .field public static final SECURITY_HAPTIC_FEEDBACK_ON_DC_MOTOR:Z
 
 .field public static final SECURITY_NAVBAR_ENABLED:Z
@@ -674,6 +676,8 @@
 
     sput-boolean v2, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY:Z
 
+    sput-boolean v2, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
     const-string v7, "SEC_FLOATING_FEATURE_BIOAUTH_CONFIG_FINGERPRINT_FEATURES"
 
     const-string v15, "capacitive_home_tablet"
diff --git a/smali_classes2/com/android/systemui/globalactions/presentation/features/GlobalActionFeatures.smali b/smali_classes2/com/android/systemui/globalactions/presentation/features/GlobalActionFeatures.smali
index 66e7610a0..427acc5ba 100644
--- a/smali_classes2/com/android/systemui/globalactions/presentation/features/GlobalActionFeatures.smali
+++ b/smali_classes2/com/android/systemui/globalactions/presentation/features/GlobalActionFeatures.smali
@@ -306,7 +306,13 @@
 
     sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY:Z
 
-    goto/16 :goto_2
+    if-nez v0, :cond_8
+
+    sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz v0, :cond_10
+
+    goto :goto_0
 
     :cond_b
     const-string v0, "SUPPORT_SIDE_KEY"
diff --git a/smali_classes2/com/android/systemui/keyguard/KeyguardFastBioUnlockController.smali b/smali_classes2/com/android/systemui/keyguard/KeyguardFastBioUnlockController.smali
index 7736b9aa4..c09f4ae25 100644
--- a/smali_classes2/com/android/systemui/keyguard/KeyguardFastBioUnlockController.smali
+++ b/smali_classes2/com/android/systemui/keyguard/KeyguardFastBioUnlockController.smali
@@ -771,6 +771,33 @@
     return p0
 .end method
 
+.method public final isFingerprintUnlocked()Z
+    .locals 1
+
+    sget v0, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->MODE_FLAG_ENABLED:I
+
+    invoke-virtual {p0, v0}, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->isMode(I)Z
+
+    move-result v0
+
+    if-eqz v0, :cond_0
+
+    iget-object p0, p0, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->biometricSourceType:Landroid/hardware/biometrics/BiometricSourceType;
+
+    sget-object v0, Landroid/hardware/biometrics/BiometricSourceType;->FINGERPRINT:Landroid/hardware/biometrics/BiometricSourceType;
+
+    if-ne p0, v0, :cond_0
+
+    const/4 p0, 0x1
+
+    return p0
+
+    :cond_0
+    const/4 p0, 0x0
+
+    return p0
+.end method
+
 .method public final isMode(I)Z
     .locals 0
 
diff --git a/smali_classes2/com/android/systemui/keyguard/KeyguardSecLegacyUnlockAnimationControllerImpl$playCannedUnlockAnimation$6.smali b/smali_classes2/com/android/systemui/keyguard/KeyguardSecLegacyUnlockAnimationControllerImpl$playCannedUnlockAnimation$6.smali
index 410099711..f94bb2fa7 100644
--- a/smali_classes2/com/android/systemui/keyguard/KeyguardSecLegacyUnlockAnimationControllerImpl$playCannedUnlockAnimation$6.smali
+++ b/smali_classes2/com/android/systemui/keyguard/KeyguardSecLegacyUnlockAnimationControllerImpl$playCannedUnlockAnimation$6.smali
@@ -163,7 +163,7 @@
     :try_start_0
     iget-object v0, p0, Lcom/android/systemui/keyguard/KeyguardUnlockAnimationController;->launcherUnlockController:Lcom/android/systemui/shared/system/smartspace/ILauncherUnlockAnimationController$Stub$Proxy;
 
-    if-eqz v0, :cond_5
+    if-eqz v0, :cond_6
 
     new-instance v1, Landroid/graphics/Rect;
 
@@ -175,7 +175,7 @@
     :try_end_0
     .catch Landroid/os/RemoteException; {:try_start_0 .. :try_end_0} :catch_0
 
-    goto :goto_0
+    goto/16 :goto_0
 
     :catch_0
     move-exception v0
@@ -187,15 +187,32 @@
     goto :goto_0
 
     :cond_2
-    sget-object v0, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz v0, :cond_3
+
+    iget-object v0, p0, Lcom/android/systemui/keyguard/KeyguardSecLegacyUnlockAnimationControllerImpl;->keyguardViewMediatorLazy:Ldagger/Lazy;
+
+    invoke-interface {v0}, Ldagger/Lazy;->get()Ljava/lang/Object;
+
+    move-result-object v0
+
+    check-cast v0, Lcom/android/systemui/keyguard/KeyguardViewMediator;
+
+    iget-object v0, v0, Lcom/android/systemui/keyguard/KeyguardViewMediator;->mHelper:Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;
+
+    iget-object v0, v0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->updateMonitor:Lcom/android/keyguard/KeyguardUpdateMonitor;
+
+    invoke-interface {v0}, Lcom/android/keyguard/KeyguardSecUpdateMonitor;->removeMaskViewForOpticalFpSensor()V
 
+    :cond_3
     iget-object v0, p0, Lcom/android/systemui/keyguard/KeyguardSecLegacyUnlockAnimationControllerImpl;->cannedAnimatorSet:Landroid/animation/AnimatorSet;
 
-    if-eqz v0, :cond_3
+    if-eqz v0, :cond_4
 
     invoke-virtual {v0}, Landroid/animation/AnimatorSet;->cancel()V
 
-    :cond_3
+    :cond_4
     new-instance v0, Landroid/animation/AnimatorSet;
 
     invoke-direct {v0}, Landroid/animation/AnimatorSet;-><init>()V
@@ -240,7 +257,7 @@
 
     iget-object v0, p0, Lcom/android/systemui/keyguard/KeyguardSecLegacyUnlockAnimationControllerImpl;->openingWallpaperLeash:Landroid/view/SurfaceControl;
 
-    if-eqz v0, :cond_4
+    if-eqz v0, :cond_5
 
     iget-object v1, p0, Lcom/android/systemui/keyguard/KeyguardSecLegacyUnlockAnimationControllerImpl;->curTransaction:Landroid/view/SurfaceControl$Transaction;
 
@@ -250,7 +267,7 @@
 
     invoke-virtual {v1, v0, v2}, Landroid/view/SurfaceControl$Transaction;->setAlpha(Landroid/view/SurfaceControl;F)Landroid/view/SurfaceControl$Transaction;
 
-    :cond_4
+    :cond_5
     const/4 v0, 0x0
 
     iput v0, p0, Lcom/android/systemui/keyguard/KeyguardSecLegacyUnlockAnimationControllerImpl;->skipFrameCount:I
@@ -271,11 +288,11 @@
 
     iget-object v0, p0, Lcom/android/systemui/keyguard/KeyguardSecLegacyUnlockAnimationControllerImpl;->cannedAnimatorSet:Landroid/animation/AnimatorSet;
 
-    if-eqz v0, :cond_5
+    if-eqz v0, :cond_6
 
     invoke-virtual {v0}, Landroid/animation/AnimatorSet;->start()V
 
-    :cond_5
+    :cond_6
     :goto_0
     iget-object v0, p0, Lcom/android/systemui/keyguard/KeyguardSecLegacyUnlockAnimationControllerImpl;->mainExecutor:Ljava/util/concurrent/Executor;
 
diff --git a/smali_classes2/com/android/systemui/keyguard/KeyguardViewMediator.smali b/smali_classes2/com/android/systemui/keyguard/KeyguardViewMediator.smali
index cfb215a58..d5e52cc58 100644
--- a/smali_classes2/com/android/systemui/keyguard/KeyguardViewMediator.smali
+++ b/smali_classes2/com/android/systemui/keyguard/KeyguardViewMediator.smali
@@ -6701,10 +6701,17 @@
 
     move-result v2
 
+    if-eqz v2, :cond_1
+
+    sget-boolean v2, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
     if-eqz v2, :cond_0
 
-    sget-object v2, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    iget-object v2, p1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->updateMonitor:Lcom/android/keyguard/KeyguardUpdateMonitor;
 
+    invoke-interface {v2}, Lcom/android/keyguard/KeyguardSecUpdateMonitor;->removeMaskViewForOpticalFpSensor()V
+
+    :cond_0
     invoke-virtual {p1}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->removeShowMsg()V
 
     iget-object p1, p1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->viewControllerLazy:Ldagger/Lazy;
@@ -6719,17 +6726,17 @@
 
     goto :goto_0
 
-    :cond_0
+    :cond_1
     move v0, v1
 
     :goto_0
-    if-eqz v0, :cond_1
+    if-eqz v0, :cond_2
 
     invoke-virtual {p0}, Lcom/android/systemui/keyguard/KeyguardViewMediator;->tryKeyguardDone$1()V
 
     goto :goto_1
 
-    :cond_1
+    :cond_2
     iget-object p1, p0, Lcom/android/systemui/keyguard/KeyguardViewMediator;->mKeyguardViewControllerLazy:Ldagger/Lazy;
 
     invoke-interface {p1}, Ldagger/Lazy;->get()Ljava/lang/Object;
diff --git a/smali_classes2/com/android/systemui/keyguard/KeyguardViewMediatorHelperImpl.smali b/smali_classes2/com/android/systemui/keyguard/KeyguardViewMediatorHelperImpl.smali
index 1fb9f3e72..3a90828f9 100644
--- a/smali_classes2/com/android/systemui/keyguard/KeyguardViewMediatorHelperImpl.smali
+++ b/smali_classes2/com/android/systemui/keyguard/KeyguardViewMediatorHelperImpl.smali
@@ -1333,19 +1333,19 @@
 
     const/4 v9, 0x0
 
-    if-eq v2, v3, :cond_5d
+    if-eq v2, v3, :cond_5e
 
     const/16 v3, 0x44e
 
-    if-eq v2, v3, :cond_59
+    if-eq v2, v3, :cond_5a
 
     const/16 v3, 0x4b1
 
-    if-eq v2, v3, :cond_55
+    if-eq v2, v3, :cond_56
 
     const/16 v3, 0x515
 
-    if-eq v2, v3, :cond_54
+    if-eq v2, v3, :cond_55
 
     packed-switch v2, :pswitch_data_0
 
@@ -1354,7 +1354,7 @@
     :pswitch_0
     sget-boolean v2, Lcom/android/systemui/LsRune;->SUBSCREEN_LARGE_FRONT_SUB_DISPLAY:Z
 
-    if-eqz v2, :cond_5e
+    if-eqz v2, :cond_5f
 
     iget-object v1, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->subScreenManager:Lcom/android/systemui/subscreen/SubScreenManager;
 
@@ -1680,7 +1680,7 @@
 
     const-string v14, "KeyguardViewMediator"
 
-    if-eqz v0, :cond_25
+    if-eqz v0, :cond_26
 
     invoke-virtual {v1, v12}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->isDisabledUnlockAnimation(Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;)Z
 
@@ -1806,20 +1806,12 @@
     goto :goto_b
 
     :cond_12
-    sget v0, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->MODE_FLAG_ENABLED:I
-
-    invoke-virtual {v15, v0}, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->isMode(I)Z
+    invoke-virtual {v15}, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->isFingerprintUnlocked()Z
 
     move-result v0
 
     if-eqz v0, :cond_10
 
-    iget-object v0, v15, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->biometricSourceType:Landroid/hardware/biometrics/BiometricSourceType;
-
-    sget-object v2, Landroid/hardware/biometrics/BiometricSourceType;->FINGERPRINT:Landroid/hardware/biometrics/BiometricSourceType;
-
-    if-ne v0, v2, :cond_10
-
     :goto_b
     iget-object v0, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->fixedRotationMonitor:Lcom/android/systemui/keyguard/KeyguardFixedRotationMonitor;
 
@@ -1852,8 +1844,21 @@
     move/from16 v16, v8
 
     :goto_c
-    sget-object v2, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    sget-boolean v2, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
 
+    if-eqz v2, :cond_15
+
+    invoke-virtual {v15}, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->isFingerprintUnlocked()Z
+
+    move-result v2
+
+    if-eqz v2, :cond_15
+
+    iget-object v2, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->updateMonitor:Lcom/android/keyguard/KeyguardUpdateMonitor;
+
+    invoke-interface {v2}, Lcom/android/keyguard/KeyguardSecUpdateMonitor;->removeMaskViewForOpticalFpSensor()V
+
+    :cond_15
     invoke-virtual {v0}, Lcom/android/systemui/keyguard/KeyguardFixedRotationMonitor;->isFixedRotated()Z
 
     move-result v3
@@ -1874,7 +1879,7 @@
 
     iget-object v2, v12, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mWallpapers:[Landroid/view/RemoteAnimationTarget;
 
-    if-eqz v2, :cond_17
+    if-eqz v2, :cond_18
 
     new-instance v10, Ljava/util/ArrayList;
 
@@ -1885,7 +1890,7 @@
     const/4 v11, 0x0
 
     :goto_d
-    if-ge v11, v9, :cond_16
+    if-ge v11, v9, :cond_17
 
     move-object/from16 v17, v0
 
@@ -1895,11 +1900,11 @@
 
     iget v2, v0, Landroid/view/RemoteAnimationTarget;->mode:I
 
-    if-ne v2, v8, :cond_15
+    if-ne v2, v8, :cond_16
 
     invoke-virtual {v10, v0}, Ljava/util/ArrayList;->add(Ljava/lang/Object;)Z
 
-    :cond_15
+    :cond_16
     add-int/2addr v11, v8
 
     move-object/from16 v0, v17
@@ -1908,7 +1913,7 @@
 
     goto :goto_d
 
-    :cond_16
+    :cond_17
     move-object/from16 v17, v0
 
     new-instance v0, Ljava/util/ArrayList;
@@ -1928,7 +1933,7 @@
     const/4 v9, 0x0
 
     :goto_e
-    if-ge v9, v2, :cond_18
+    if-ge v9, v2, :cond_19
 
     invoke-virtual {v10, v9}, Ljava/util/ArrayList;->get(I)Ljava/lang/Object;
 
@@ -1948,13 +1953,13 @@
 
     goto :goto_e
 
-    :cond_17
+    :cond_18
     move-object/from16 v17, v0
 
-    :cond_18
+    :cond_19
     iget-object v0, v12, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mWallpapers:[Landroid/view/RemoteAnimationTarget;
 
-    if-eqz v0, :cond_1b
+    if-eqz v0, :cond_1c
 
     new-instance v2, Ljava/util/ArrayList;
 
@@ -1965,7 +1970,7 @@
     const/4 v10, 0x0
 
     :goto_f
-    if-ge v10, v9, :cond_1a
+    if-ge v10, v9, :cond_1b
 
     aget-object v11, v0, v10
 
@@ -1973,18 +1978,18 @@
 
     iget v8, v11, Landroid/view/RemoteAnimationTarget;->mode:I
 
-    if-nez v8, :cond_19
+    if-nez v8, :cond_1a
 
     invoke-virtual {v2, v11}, Ljava/util/ArrayList;->add(Ljava/lang/Object;)Z
 
-    :cond_19
+    :cond_1a
     add-int/lit8 v10, v10, 0x1
 
     move/from16 v8, v18
 
     goto :goto_f
 
-    :cond_1a
+    :cond_1b
     move/from16 v18, v8
 
     new-instance v0, Ljava/util/ArrayList;
@@ -2004,7 +2009,7 @@
     const/4 v9, 0x0
 
     :goto_10
-    if-ge v9, v8, :cond_1c
+    if-ge v9, v8, :cond_1d
 
     invoke-virtual {v2, v9}, Ljava/util/ArrayList;->get(I)Ljava/lang/Object;
 
@@ -2024,20 +2029,20 @@
 
     goto :goto_10
 
-    :cond_1b
+    :cond_1c
     move/from16 v18, v8
 
-    :cond_1c
+    :cond_1d
     iget-object v0, v12, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mApps:[Landroid/view/RemoteAnimationTarget;
 
-    if-eqz v0, :cond_1d
+    if-eqz v0, :cond_1e
 
     array-length v2, v0
 
     const/4 v8, 0x0
 
     :goto_11
-    if-ge v8, v2, :cond_1d
+    if-ge v8, v2, :cond_1e
 
     aget-object v9, v0, v8
 
@@ -2049,18 +2054,18 @@
 
     goto :goto_11
 
-    :cond_1d
+    :cond_1e
     invoke-virtual {v4}, Ljava/util/ArrayList;->isEmpty()Z
 
     move-result v0
 
-    if-nez v0, :cond_1f
+    if-nez v0, :cond_20
 
-    if-nez v7, :cond_1e
+    if-nez v7, :cond_1f
 
     goto :goto_12
 
-    :cond_1e
+    :cond_1f
     new-instance v2, Landroid/view/SurfaceControl$Transaction;
 
     invoke-direct {v2}, Landroid/view/SurfaceControl$Transaction;-><init>()V
@@ -2077,11 +2082,11 @@
 
     move-result v0
 
-    if-nez v0, :cond_1f
+    if-nez v0, :cond_20
 
     iget-object v0, v12, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mFinishedCallback:Landroid/view/IRemoteAnimationFinishedCallback;
 
-    if-eqz v0, :cond_1f
+    if-eqz v0, :cond_20
 
     const/4 v2, 0x0
 
@@ -2093,7 +2098,7 @@
 
     iput-object v0, v12, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mApps:[Landroid/view/RemoteAnimationTarget;
 
-    :cond_1f
+    :cond_20
     :goto_12
     sget-object v0, Ljava/lang/Boolean;->TRUE:Ljava/lang/Boolean;
 
@@ -2135,11 +2140,11 @@
 
     move-result v2
 
-    if-eqz v2, :cond_21
+    if-eqz v2, :cond_22
 
     iget-object v2, v12, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mFinishedCallback:Landroid/view/IRemoteAnimationFinishedCallback;
 
-    if-eqz v2, :cond_20
+    if-eqz v2, :cond_21
 
     :try_start_0
     invoke-interface {v2}, Landroid/view/IRemoteAnimationFinishedCallback;->onAnimationFinished()V
@@ -2166,22 +2171,22 @@
 
     goto :goto_16
 
-    :cond_20
+    :cond_21
     const/4 v4, 0x0
 
     :goto_16
     iput-object v4, v12, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mApps:[Landroid/view/RemoteAnimationTarget;
 
-    :cond_21
-    if-eqz v0, :cond_22
+    :cond_22
+    if-eqz v0, :cond_23
 
     const-string/jumbo v2, "showForegroundImmediatelyIfNeeded returns true"
 
     invoke-static {v14, v2}, Lcom/android/systemui/keyguard/Log;->d(Ljava/lang/String;Ljava/lang/String;)V
 
-    :cond_22
+    :cond_23
     :goto_17
-    if-eqz v0, :cond_25
+    if-eqz v0, :cond_26
 
     new-instance v0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl$$ExternalSyntheticLambda23;
 
@@ -2189,7 +2194,7 @@
 
     iget-object v1, v15, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->delayedActionParams:Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController$DelayedActionParams;
 
-    if-eqz v1, :cond_24
+    if-eqz v1, :cond_25
 
     iget-object v2, v1, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController$DelayedActionParams;->handler:Landroid/os/Handler;
 
@@ -2199,18 +2204,18 @@
 
     move-result v4
 
-    if-eqz v4, :cond_23
+    if-eqz v4, :cond_24
 
     invoke-virtual {v2, v3}, Landroid/os/Handler;->removeCallbacks(Ljava/lang/Runnable;)V
 
-    :cond_23
+    :cond_24
     move/from16 v2, v18
 
     iput-boolean v2, v1, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController$DelayedActionParams;->isDiscard:Z
 
     goto :goto_18
 
-    :cond_24
+    :cond_25
     move/from16 v2, v18
 
     :goto_18
@@ -2228,7 +2233,7 @@
 
     goto/16 :goto_36
 
-    :cond_25
+    :cond_26
     iget-object v0, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->viewMediatorLazy:Ldagger/Lazy;
 
     invoke-interface {v0}, Ldagger/Lazy;->get()Ljava/lang/Object;
@@ -2241,36 +2246,36 @@
 
     move-result v0
 
-    if-eqz v0, :cond_26
+    if-eqz v0, :cond_27
 
     goto/16 :goto_1b
 
-    :cond_26
+    :cond_27
     invoke-virtual {v1, v12}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->isDisabledUnlockAnimation(Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;)Z
 
     move-result v0
 
-    if-eqz v0, :cond_2e
+    if-eqz v0, :cond_2f
 
-    if-eqz v12, :cond_2e
+    if-eqz v12, :cond_2f
 
     iget-object v0, v12, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mApps:[Landroid/view/RemoteAnimationTarget;
 
-    if-eqz v0, :cond_2d
+    if-eqz v0, :cond_2e
 
     array-length v0, v0
 
-    if-nez v0, :cond_27
+    if-nez v0, :cond_28
 
     const/4 v8, 0x1
 
     goto :goto_19
 
-    :cond_27
+    :cond_28
     const/4 v8, 0x0
 
     :goto_19
-    if-nez v8, :cond_2c
+    if-nez v8, :cond_2d
 
     new-instance v2, Landroid/view/SurfaceControl$Transaction;
 
@@ -2284,7 +2289,7 @@
 
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->surfaceControllerLazy:Ldagger/Lazy;
 
-    if-nez v0, :cond_28
+    if-nez v0, :cond_29
 
     invoke-interface {v3}, Ldagger/Lazy;->get()Ljava/lang/Object;
 
@@ -2296,20 +2301,20 @@
 
     invoke-static {v0, v2, v4}, Lcom/android/systemui/keyguard/KeyguardSurfaceControllerImpl;->setKeyguardSurfaceAppearAmount$default(Lcom/android/systemui/keyguard/KeyguardSurfaceControllerImpl;Landroid/view/SurfaceControl$Transaction;I)V
 
-    :cond_28
+    :cond_29
     iget-object v0, v12, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mApps:[Landroid/view/RemoteAnimationTarget;
 
     new-instance v4, Lkotlin/jvm/internal/ArrayIterator;
 
     invoke-direct {v4, v0}, Lkotlin/jvm/internal/ArrayIterator;-><init>([Ljava/lang/Object;)V
 
-    :cond_29
+    :cond_2a
     :goto_1a
     invoke-virtual {v4}, Lkotlin/jvm/internal/ArrayIterator;->hasNext()Z
 
     move-result v0
 
-    if-eqz v0, :cond_2b
+    if-eqz v0, :cond_2c
 
     invoke-virtual {v4}, Lkotlin/jvm/internal/ArrayIterator;->next()Ljava/lang/Object;
 
@@ -2317,11 +2322,11 @@
 
     check-cast v0, Landroid/view/RemoteAnimationTarget;
 
-    if-eqz v0, :cond_29
+    if-eqz v0, :cond_2a
 
     iget-object v0, v0, Landroid/view/RemoteAnimationTarget;->leash:Landroid/view/SurfaceControl;
 
-    if-eqz v0, :cond_29
+    if-eqz v0, :cond_2a
 
     invoke-interface {v3}, Ldagger/Lazy;->get()Ljava/lang/Object;
 
@@ -2337,11 +2342,11 @@
 
     move-result v6
 
-    if-nez v6, :cond_2a
+    if-nez v6, :cond_2b
 
     goto :goto_1a
 
-    :cond_2a
+    :cond_2b
     const-string v6, "KeyguardSurface"
 
     const-string/jumbo v7, "setLeashAppearAmount amount=1.0 hasTransaction=true"
@@ -2372,20 +2377,20 @@
 
     goto :goto_1a
 
-    :cond_2b
+    :cond_2c
     invoke-virtual {v2}, Landroid/view/SurfaceControl$Transaction;->apply()V
 
     invoke-virtual {v2}, Landroid/view/SurfaceControl$Transaction;->close()V
 
-    :cond_2c
+    :cond_2d
     const/4 v2, 0x0
 
     iput-object v2, v12, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mApps:[Landroid/view/RemoteAnimationTarget;
 
-    :cond_2d
+    :cond_2e
     iget-object v0, v12, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mFinishedCallback:Landroid/view/IRemoteAnimationFinishedCallback;
 
-    if-eqz v0, :cond_2e
+    if-eqz v0, :cond_2f
 
     :try_start_2
     const-string v2, "keepOrDisableUnlockAnimation disabled"
@@ -2401,7 +2406,7 @@
 
     iput-object v2, v12, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mFinishedCallback:Landroid/view/IRemoteAnimationFinishedCallback;
 
-    :cond_2e
+    :cond_2f
     :goto_1b
     iget-object v0, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->pm:Landroid/os/PowerManager;
 
@@ -2419,11 +2424,11 @@
 
     move-result v0
 
-    if-nez v0, :cond_2f
+    if-nez v0, :cond_30
 
     iget-boolean v0, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->hidingByDisabled:Z
 
-    if-nez v0, :cond_2f
+    if-nez v0, :cond_30
 
     iget v0, v13, Landroid/os/Message;->what:I
 
@@ -2444,7 +2449,7 @@
     :try_start_3
     iget-object v0, v12, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mFinishedCallback:Landroid/view/IRemoteAnimationFinishedCallback;
 
-    if-eqz v0, :cond_5e
+    if-eqz v0, :cond_5f
 
     invoke-interface {v0}, Landroid/view/IRemoteAnimationFinishedCallback;->onAnimationFinished()V
     :try_end_3
@@ -2452,7 +2457,7 @@
 
     goto/16 :goto_36
 
-    :cond_2f
+    :cond_30
     invoke-virtual {v1}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->getHandler$1()Landroid/os/Handler;
 
     move-result-object v0
@@ -2466,22 +2471,22 @@
 
     sget-boolean v2, Lcom/android/systemui/LsRune;->SUBSCREEN_LARGE_FRONT_SUB_DISPLAY:Z
 
-    if-eqz v2, :cond_30
+    if-eqz v2, :cond_31
 
     iget v2, v0, Landroid/os/Message;->arg1:I
 
     const/4 v3, 0x1
 
-    if-ne v2, v3, :cond_31
+    if-ne v2, v3, :cond_32
 
     iput-boolean v3, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->handleFoldOpenMsg:Z
 
     goto :goto_1c
 
-    :cond_30
+    :cond_31
     const/4 v3, 0x1
 
-    :cond_31
+    :cond_32
     :goto_1c
     iget-object v1, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->foldControllerImpl:Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;
 
@@ -2489,25 +2494,25 @@
 
     iget v2, v0, Landroid/os/Message;->arg1:I
 
-    if-ne v2, v3, :cond_32
+    if-ne v2, v3, :cond_33
 
     const/4 v2, 0x1
 
     goto :goto_1d
 
-    :cond_32
+    :cond_33
     const/4 v2, 0x0
 
     :goto_1d
     iget v0, v0, Landroid/os/Message;->arg2:I
 
-    if-nez v0, :cond_33
+    if-nez v0, :cond_34
 
     const/4 v0, 0x1
 
     goto :goto_1e
 
-    :cond_33
+    :cond_34
     const/4 v0, 0x0
 
     :goto_1e
@@ -2547,7 +2552,7 @@
 
     invoke-static {v4, v6}, Lcom/android/systemui/keyguard/Log;->d(Ljava/lang/String;Ljava/lang/String;)V
 
-    if-nez v0, :cond_42
+    if-nez v0, :cond_43
 
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->foldConfig:Lcom/android/systemui/keyguard/KeyguardFoldControllerConfig;
 
@@ -2557,9 +2562,9 @@
 
     sget-boolean v3, Lcom/android/systemui/LsRune;->KEYGUARD_SUB_DISPLAY_LOCK:Z
 
-    if-eqz v3, :cond_41
+    if-eqz v3, :cond_42
 
-    if-eqz v2, :cond_40
+    if-eqz v2, :cond_41
 
     invoke-virtual {v1}, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->getViewMediator()Lcom/android/systemui/keyguard/KeyguardViewMediator;
 
@@ -2589,7 +2594,7 @@
 
     move-result v4
 
-    if-eqz v4, :cond_34
+    if-eqz v4, :cond_35
 
     const/4 v4, 0x1
 
@@ -2601,12 +2606,12 @@
 
     goto/16 :goto_26
 
-    :cond_34
+    :cond_35
     invoke-virtual {v3}, Lcom/android/systemui/keyguard/KeyguardViewMediator;->isShowingAndNotOccluded()Z
 
     move-result v4
 
-    if-eqz v4, :cond_3f
+    if-eqz v4, :cond_40
 
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->foldConfig:Lcom/android/systemui/keyguard/KeyguardFoldControllerConfig;
 
@@ -2616,7 +2621,7 @@
 
     sget-boolean v3, Lcom/android/systemui/CscRune;->SECURITY_SIM_PERM_DISABLED:Z
 
-    if-eqz v3, :cond_35
+    if-eqz v3, :cond_36
 
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->updateMonitor:Lcom/android/keyguard/KeyguardUpdateMonitor;
 
@@ -2624,7 +2629,7 @@
 
     move-result v3
 
-    if-eqz v3, :cond_35
+    if-eqz v3, :cond_36
 
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->dependency:Lcom/android/systemui/keyguard/KeyguardFoldControllerDependency;
 
@@ -2640,7 +2645,7 @@
 
     goto/16 :goto_26
 
-    :cond_35
+    :cond_36
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->viewMediatorHelper$delegate:Lkotlin/Lazy;
 
     invoke-interface {v3}, Lkotlin/Lazy;->getValue()Ljava/lang/Object;
@@ -2664,7 +2669,7 @@
 
     move-result v6
 
-    if-eqz v6, :cond_36
+    if-eqz v6, :cond_37
 
     iget-boolean v3, v3, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->curIsOccluded:Z
     :try_end_4
@@ -2672,7 +2677,7 @@
 
     const/4 v6, 0x1
 
-    if-ne v6, v3, :cond_36
+    if-ne v6, v3, :cond_37
 
     const/4 v3, 0x1
 
@@ -2683,13 +2688,13 @@
 
     goto/16 :goto_25
 
-    :cond_36
+    :cond_37
     const/4 v3, 0x0
 
     :goto_1f
     monitor-exit v4
 
-    if-eqz v3, :cond_37
+    if-eqz v3, :cond_38
 
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->dependency:Lcom/android/systemui/keyguard/KeyguardFoldControllerDependency;
 
@@ -2705,7 +2710,7 @@
 
     goto/16 :goto_26
 
-    :cond_37
+    :cond_38
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->viewMediatorHelper$delegate:Lkotlin/Lazy;
 
     invoke-interface {v3}, Lkotlin/Lazy;->getValue()Ljava/lang/Object;
@@ -2736,11 +2741,11 @@
 
     iget-object v3, v3, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->viewMediatorProvider:Lcom/android/systemui/keyguard/ViewMediatorProvider;
 
-    if-eqz v3, :cond_38
+    if-eqz v3, :cond_39
 
     goto :goto_20
 
-    :cond_38
+    :cond_39
     const/4 v3, 0x0
 
     :goto_20
@@ -2756,7 +2761,7 @@
 
     move-result v3
 
-    if-nez v3, :cond_39
+    if-nez v3, :cond_3a
 
     iget-object v4, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->dependency:Lcom/android/systemui/keyguard/KeyguardFoldControllerDependency;
 
@@ -2768,7 +2773,7 @@
 
     invoke-static {v6}, Lcom/android/systemui/keyguard/KeyguardUnlockInfo;->setAuthDetail(Lcom/android/keyguard/KeyguardSecurityModel$SecurityMode;)V
 
-    :cond_39
+    :cond_3a
     iget-object v4, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->updateMonitor:Lcom/android/keyguard/KeyguardUpdateMonitor;
 
     iget-object v6, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->selectedUserInteractor:Lcom/android/systemui/user/domain/interactor/SelectedUserInteractor;
@@ -2781,13 +2786,13 @@
 
     move-result v4
 
-    if-eqz v3, :cond_3b
+    if-eqz v3, :cond_3c
 
-    if-eqz v4, :cond_3a
+    if-eqz v4, :cond_3b
 
     goto :goto_21
 
-    :cond_3a
+    :cond_3b
     const/4 v3, 0x1
 
     invoke-virtual {v1, v3}, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->setFoldOpenState(I)V
@@ -2804,7 +2809,7 @@
 
     goto/16 :goto_26
 
-    :cond_3b
+    :cond_3c
     :goto_21
     invoke-virtual {v1}, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->getViewMediator()Lcom/android/systemui/keyguard/KeyguardViewMediator;
 
@@ -2818,22 +2823,22 @@
 
     move-result v3
 
-    if-eqz v3, :cond_3d
+    if-eqz v3, :cond_3e
 
     iget v3, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->wakeReason:I
 
     const/16 v4, 0x9
 
-    if-ne v3, v4, :cond_3c
+    if-ne v3, v4, :cond_3d
 
     goto :goto_22
 
-    :cond_3c
+    :cond_3d
     move v11, v5
 
     goto :goto_23
 
-    :cond_3d
+    :cond_3e
     :goto_22
     const/4 v11, 0x3
 
@@ -2856,13 +2861,13 @@
 
     iget-object v3, v3, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->viewMediatorProvider:Lcom/android/systemui/keyguard/ViewMediatorProvider;
 
-    if-eqz v3, :cond_3e
+    if-eqz v3, :cond_3f
 
     move-object v9, v3
 
     goto :goto_24
 
-    :cond_3e
+    :cond_3f
     const/4 v9, 0x0
 
     :goto_24
@@ -2877,7 +2882,7 @@
 
     throw v0
 
-    :cond_3f
+    :cond_40
     invoke-virtual {v3}, Lcom/android/systemui/keyguard/KeyguardViewMediator;->maybeHandlePendingLock()V
 
     iget-object v4, v3, Lcom/android/systemui/keyguard/KeyguardViewMediator;->mHelper:Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;
@@ -2894,7 +2899,7 @@
 
     move-result v4
 
-    if-eqz v4, :cond_42
+    if-eqz v4, :cond_43
 
     const/4 v4, 0x1
 
@@ -2906,7 +2911,7 @@
 
     goto :goto_26
 
-    :cond_40
+    :cond_41
     invoke-virtual {v1}, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->getViewMediator()Lcom/android/systemui/keyguard/KeyguardViewMediator;
 
     move-result-object v3
@@ -2915,7 +2920,7 @@
 
     move-result v4
 
-    if-eqz v4, :cond_42
+    if-eqz v4, :cond_43
 
     invoke-virtual {v3}, Lcom/android/systemui/keyguard/KeyguardViewMediator;->getViewMediatorCallback()Lcom/android/keyguard/ViewMediatorCallback;
 
@@ -2925,7 +2930,7 @@
 
     goto :goto_26
 
-    :cond_41
+    :cond_42
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->foldConfig:Lcom/android/systemui/keyguard/KeyguardFoldControllerConfig;
 
     check-cast v3, Lcom/android/systemui/keyguard/KeyguardFoldControllerConfigImpl;
@@ -2934,7 +2939,7 @@
 
     sget-boolean v3, Lcom/android/systemui/LsRune;->SUBSCREEN_WATCHFACE:Z
 
-    if-eqz v3, :cond_42
+    if-eqz v3, :cond_43
 
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->viewMediatorHelper$delegate:Lkotlin/Lazy;
 
@@ -2948,7 +2953,7 @@
 
     invoke-virtual {v3}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->adjustStatusBarLocked$2()V
 
-    :cond_42
+    :cond_43
     :goto_26
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->normalRankedStateListeners:Ljava/util/List;
 
@@ -2969,19 +2974,19 @@
 
     iget-object v0, v0, Landroid/os/Message;->obj:Ljava/lang/Object;
 
-    if-eqz v0, :cond_43
+    if-eqz v0, :cond_44
 
     check-cast v0, Lcom/android/internal/policy/IKeyguardDrawnCallback;
 
     goto :goto_27
 
-    :cond_43
+    :cond_44
     const/4 v0, 0x0
 
     :goto_27
     const-string v2, "handleNotifyScreenTurningOn fastWakeUnlockMode="
 
-    if-nez v0, :cond_48
+    if-nez v0, :cond_49
 
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->fastUnlockController:Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;
 
@@ -2989,7 +2994,7 @@
 
     move-result v3
 
-    if-eqz v3, :cond_46
+    if-eqz v3, :cond_47
 
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->fastUnlockController:Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;
 
@@ -3003,23 +3008,23 @@
 
     move-result v3
 
-    if-eqz v3, :cond_44
+    if-eqz v3, :cond_45
 
     sget v3, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->MODE_FLAG_FRAME_COMMIT:I
 
     and-int/2addr v3, v5
 
-    if-nez v3, :cond_44
+    if-nez v3, :cond_45
 
     sget v3, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->MODE_FLAG_FRAME_REQUEST:I
 
     and-int/2addr v5, v3
 
-    if-ne v5, v3, :cond_44
+    if-ne v5, v3, :cond_45
 
     goto :goto_29
 
-    :cond_44
+    :cond_45
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->fastUnlockController:Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;
 
     invoke-virtual {v3}, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->getMode()I
@@ -3030,34 +3035,34 @@
 
     move-result v3
 
-    if-eqz v3, :cond_45
+    if-eqz v3, :cond_46
 
     sget v3, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->MODE_FLAG_FRAME_COMMIT:I
 
     and-int/2addr v5, v3
 
-    if-ne v5, v3, :cond_45
+    if-ne v5, v3, :cond_46
 
     const/4 v3, 0x1
 
     goto :goto_28
 
-    :cond_45
+    :cond_46
     move v3, v4
 
     :goto_28
-    if-nez v3, :cond_47
+    if-nez v3, :cond_48
 
-    :cond_46
+    :cond_47
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->fastUnlockController:Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;
 
     invoke-virtual {v3}, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->isFastWakeAndUnlockMode()Z
 
     move-result v3
 
-    if-nez v3, :cond_48
+    if-nez v3, :cond_49
 
-    :cond_47
+    :cond_48
     :goto_29
     const-string v0, "handleNotifyScreenTurningOn"
 
@@ -3069,7 +3074,7 @@
 
     return-void
 
-    :cond_48
+    :cond_49
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->lock$delegate:Lkotlin/Lazy;
 
     invoke-interface {v3}, Lkotlin/Lazy;->getValue()Ljava/lang/Object;
@@ -3101,13 +3106,13 @@
 
     iget v6, v6, Lcom/android/systemui/statusbar/phone/BiometricUnlockController;->mMode:I
 
-    if-eqz v6, :cond_49
+    if-eqz v6, :cond_4a
 
     const/4 v6, 0x1
 
     goto :goto_2a
 
-    :cond_49
+    :cond_4a
     move v6, v4
 
     :goto_2a
@@ -3117,7 +3122,7 @@
 
     cmp-long v7, v7, v9
 
-    if-eqz v7, :cond_4a
+    if-eqz v7, :cond_4b
 
     invoke-static {}, Landroid/os/SystemClock;->elapsedRealtime()J
 
@@ -3134,7 +3139,7 @@
 
     goto/16 :goto_2e
 
-    :cond_4a
+    :cond_4b
     :goto_2b
     iget-object v7, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->fastUnlockController:Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;
 
@@ -3144,11 +3149,11 @@
 
     iget-object v8, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->viewMediatorProvider:Lcom/android/systemui/keyguard/ViewMediatorProvider;
 
-    if-eqz v8, :cond_4b
+    if-eqz v8, :cond_4c
 
     goto :goto_2c
 
-    :cond_4b
+    :cond_4c
     const/4 v8, 0x0
 
     :goto_2c
@@ -3168,11 +3173,11 @@
 
     move-result v11
 
-    if-eqz v0, :cond_4c
+    if-eqz v0, :cond_4d
 
     const/4 v4, 0x1
 
-    :cond_4c
+    :cond_4d
     new-instance v12, Ljava/lang/StringBuilder;
 
     invoke-direct {v12, v2}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
@@ -3223,38 +3228,38 @@
     :try_end_5
     .catchall {:try_start_5 .. :try_end_5} :catchall_1
 
-    if-nez v0, :cond_4d
+    if-nez v0, :cond_4e
 
     monitor-exit v3
 
     return-void
 
-    :cond_4d
+    :cond_4e
     :try_start_6
     iget-object v2, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->fastUnlockController:Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;
 
     iget-boolean v2, v2, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->needsBlankScreen:Z
 
-    if-nez v2, :cond_4e
+    if-nez v2, :cond_4f
 
-    if-nez v7, :cond_4f
+    if-nez v7, :cond_50
 
-    :cond_4e
-    if-nez v6, :cond_50
+    :cond_4f
+    if-nez v6, :cond_51
 
-    if-nez v5, :cond_4f
+    if-nez v5, :cond_50
 
-    if-eqz v8, :cond_50
+    if-eqz v8, :cond_51
 
-    :cond_4f
+    :cond_50
     iput-object v0, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->drawnCallback:Lcom/android/internal/policy/IKeyguardDrawnCallback;
 
     goto :goto_2d
 
-    :cond_50
+    :cond_51
     sget-boolean v2, Lcom/android/systemui/LsRune;->KEYGUARD_DELAY_NOTIFY_DRAWN_PREMIUM_WATCH:Z
 
-    if-eqz v2, :cond_52
+    if-eqz v2, :cond_53
 
     iget-object v2, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->foldControllerImpl:Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;
 
@@ -3262,7 +3267,7 @@
 
     move-result v2
 
-    if-nez v2, :cond_52
+    if-nez v2, :cond_53
 
     iget-object v2, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->settingsHelper:Lcom/android/systemui/util/SettingsHelper;
 
@@ -3270,13 +3275,13 @@
 
     move-result v2
 
-    if-eqz v2, :cond_52
+    if-eqz v2, :cond_53
 
     invoke-virtual {v1}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->hasOccludedMsg$1()Z
 
     move-result v2
 
-    if-nez v2, :cond_51
+    if-nez v2, :cond_52
 
     iget-object v2, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->viewMediatorLazy:Ldagger/Lazy;
 
@@ -3290,16 +3295,16 @@
 
     move-result v2
 
-    if-nez v2, :cond_52
+    if-nez v2, :cond_53
 
-    :cond_51
+    :cond_52
     iget-object v2, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->keyguardVisibilityMonitor:Lcom/android/systemui/keyguard/KeyguardVisibilityMonitor;
 
     invoke-virtual {v2}, Lcom/android/systemui/keyguard/KeyguardVisibilityMonitor;->isVisible()Z
 
     move-result v2
 
-    if-eqz v2, :cond_52
+    if-eqz v2, :cond_53
 
     iput-object v0, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->drawnCallback:Lcom/android/internal/policy/IKeyguardDrawnCallback;
 
@@ -3327,14 +3332,14 @@
 
     return-void
 
-    :cond_52
+    :cond_53
     const-wide/16 v4, 0xc8
 
     cmp-long v2, v9, v4
 
-    if-gez v2, :cond_53
+    if-gez v2, :cond_54
 
-    if-nez v6, :cond_53
+    if-nez v6, :cond_54
 
     :try_start_7
     iput-object v0, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->drawnCallback:Lcom/android/internal/policy/IKeyguardDrawnCallback;
@@ -3359,7 +3364,7 @@
 
     return-void
 
-    :cond_53
+    :cond_54
     :try_start_8
     invoke-virtual {v1, v0}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->notifyDrawn(Lcom/android/internal/policy/IKeyguardDrawnCallback;)V
 
@@ -3386,7 +3391,7 @@
 
     return-void
 
-    :cond_54
+    :cond_55
     const-string v0, "adjustStatusBarLocked - ADJUST_STATUS_BAR : flags=0x"
 
     :try_start_9
@@ -3394,7 +3399,7 @@
 
     move-result-object v2
 
-    if-eqz v2, :cond_5e
+    if-eqz v2, :cond_5f
 
     iget v3, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->disableFlags:I
 
@@ -3449,7 +3454,7 @@
 
     goto/16 :goto_36
 
-    :cond_55
+    :cond_56
     const/4 v4, 0x0
 
     const-string v0, "KeyguardViewMediator"
@@ -3460,7 +3465,7 @@
 
     sget-boolean v0, Lcom/android/systemui/LsRune;->SUBSCREEN_UI:Z
 
-    if-eqz v0, :cond_5e
+    if-eqz v0, :cond_5f
 
     iget-object v0, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->subScreenManager:Lcom/android/systemui/subscreen/SubScreenManager;
 
@@ -3474,7 +3479,7 @@
 
     iget-object v2, v0, Lcom/android/systemui/subscreen/SubScreenManager;->mSubDisplay:Landroid/view/Display;
 
-    if-nez v2, :cond_5e
+    if-nez v2, :cond_5f
 
     const-string v2, "init() "
 
@@ -3488,7 +3493,7 @@
 
     move-result-object v2
 
-    if-eqz v2, :cond_58
+    if-eqz v2, :cond_59
 
     new-instance v3, Ljava/lang/StringBuilder;
 
@@ -3505,11 +3510,11 @@
     move v10, v4
 
     :goto_2f
-    if-ge v10, v3, :cond_58
+    if-ge v10, v3, :cond_59
 
     aget-object v4, v2, v10
 
-    if-nez v4, :cond_56
+    if-nez v4, :cond_57
 
     const-string v4, "Do not show SubScreen UI on null display"
 
@@ -3520,14 +3525,14 @@
 
     goto :goto_31
 
-    :cond_56
+    :cond_57
     invoke-virtual {v4}, Landroid/view/Display;->getDisplayId()I
 
     move-result v5
 
     const/4 v6, 0x1
 
-    if-ne v5, v6, :cond_57
+    if-ne v5, v6, :cond_58
 
     new-instance v2, Ljava/lang/StringBuilder;
 
@@ -3547,7 +3552,7 @@
 
     goto :goto_32
 
-    :cond_57
+    :cond_58
     new-instance v5, Ljava/lang/StringBuilder;
 
     const-string v6, "Do not show SubScreen UI on this display "
@@ -3569,7 +3574,7 @@
 
     goto :goto_2f
 
-    :cond_58
+    :cond_59
     const/4 v9, 0x0
 
     :goto_32
@@ -3583,7 +3588,7 @@
 
     sget-boolean v1, Lcom/android/systemui/LsRune;->SUBSCREEN_LARGE_FRONT_SUB_DISPLAY:Z
 
-    if-eqz v1, :cond_5e
+    if-eqz v1, :cond_5f
 
     new-instance v1, Lcom/android/systemui/subscreen/SubScreenManager$6;
 
@@ -3595,7 +3600,7 @@
 
     return-void
 
-    :cond_59
+    :cond_5a
     const-string v0, "handleLaunchPersoLock"
 
     const-string v2, "KeyguardViewMediator"
@@ -3621,7 +3626,7 @@
 
     move-result v0
 
-    if-nez v0, :cond_5a
+    if-nez v0, :cond_5b
 
     const-string v0, "doKeyguardLocked"
 
@@ -3654,7 +3659,7 @@
 
     goto :goto_35
 
-    :cond_5a
+    :cond_5b
     iget-object v0, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->KEYGUARD_DONE$delegate:Lkotlin/Lazy;
 
     invoke-interface {v0}, Lkotlin/Lazy;->getValue()Ljava/lang/Object;
@@ -3695,17 +3700,17 @@
 
     move-result v0
 
-    if-eqz v0, :cond_5c
+    if-eqz v0, :cond_5d
 
     iget-object v0, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->viewMediatorProvider:Lcom/android/systemui/keyguard/ViewMediatorProvider;
 
-    if-eqz v0, :cond_5b
+    if-eqz v0, :cond_5c
 
     move-object v9, v0
 
     goto :goto_33
 
-    :cond_5b
+    :cond_5c
     const/4 v9, 0x0
 
     :goto_33
@@ -3715,7 +3720,7 @@
 
     invoke-interface {v0, v3}, Lkotlin/jvm/functions/Function1;->invoke(Ljava/lang/Object;)Ljava/lang/Object;
 
-    :cond_5c
+    :cond_5d
     invoke-virtual {v1}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->resetStateLocked$2()V
 
     :goto_34
@@ -3732,7 +3737,7 @@
 
     throw v0
 
-    :cond_5d
+    :cond_5e
     iget-object v0, v0, Landroid/os/Message;->obj:Ljava/lang/Object;
 
     const-string v2, "KeyguardViewMediator"
@@ -3743,13 +3748,13 @@
 
     instance-of v2, v0, Lcom/android/internal/widget/RemoteLockInfo;
 
-    if-eqz v2, :cond_5f
+    if-eqz v2, :cond_60
 
     check-cast v0, Lcom/android/internal/widget/RemoteLockInfo;
 
     iget-boolean v0, v0, Lcom/android/internal/widget/RemoteLockInfo;->lockState:Z
 
-    if-nez v0, :cond_5f
+    if-nez v0, :cond_60
 
     iget-object v0, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->updateMonitor:Lcom/android/keyguard/KeyguardUpdateMonitor;
 
@@ -3759,7 +3764,7 @@
 
     const/4 v2, -0x1
 
-    if-ne v0, v2, :cond_5e
+    if-ne v0, v2, :cond_5f
 
     iget-object v0, v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->viewMediatorLazy:Ldagger/Lazy;
 
@@ -3773,21 +3778,21 @@
 
     move-result v0
 
-    if-eqz v0, :cond_5e
+    if-eqz v0, :cond_5f
 
     invoke-virtual {v1}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->resetStateLocked$2()V
 
     :catch_4
-    :cond_5e
+    :cond_5f
     :goto_36
     return-void
 
-    :cond_5f
+    :cond_60
     invoke-virtual {v1}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->isShowing$1()Z
 
     move-result v0
 
-    if-nez v0, :cond_60
+    if-nez v0, :cond_61
 
     const/4 v4, 0x0
 
@@ -3795,7 +3800,7 @@
 
     goto :goto_37
 
-    :cond_60
+    :cond_61
     invoke-virtual {v1}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->resetStateLocked$2()V
 
     :goto_37
@@ -3809,6 +3814,8 @@
 
     return-void
 
+    nop
+
     :pswitch_data_0
     .packed-switch 0x3e9
         :pswitch_5
@@ -7421,20 +7428,12 @@
     goto :goto_2
 
     :cond_7
-    sget v1, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->MODE_FLAG_ENABLED:I
-
-    invoke-virtual {v3, v1}, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->isMode(I)Z
+    invoke-virtual {v3}, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->isFingerprintUnlocked()Z
 
     move-result v1
 
     if-eqz v1, :cond_9
 
-    iget-object v1, v3, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->biometricSourceType:Landroid/hardware/biometrics/BiometricSourceType;
-
-    sget-object v4, Landroid/hardware/biometrics/BiometricSourceType;->FINGERPRINT:Landroid/hardware/biometrics/BiometricSourceType;
-
-    if-ne v1, v4, :cond_9
-
     :goto_2
     iget-object v1, p0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->fixedRotationMonitor:Lcom/android/systemui/keyguard/KeyguardFixedRotationMonitor;
 
diff --git a/smali_classes3/com/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl.smali b/smali_classes3/com/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl.smali
index 32d7a6cae..443e88e58 100644
--- a/smali_classes3/com/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl.smali
+++ b/smali_classes3/com/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl.smali
@@ -445,12 +445,21 @@
 
     const/high16 v0, 0x40000
 
+    or-int/2addr v0, p1
+
+    iput v0, v1, Landroid/view/WindowManager$LayoutParams;->samsungFlags:I
+
+    sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz v0, :cond_1
+
+    const/high16 v0, 0x60000
+
     or-int/2addr p1, v0
 
     iput p1, v1, Landroid/view/WindowManager$LayoutParams;->samsungFlags:I
 
-    sget-object p1, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
-
+    :cond_1
     invoke-virtual {p0}, Lcom/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl;->getCurrentState()Lcom/android/systemui/shade/NotificationShadeWindowState;
 
     move-result-object p1
@@ -459,7 +468,7 @@
 
     const/4 v2, 0x1
 
-    if-ne v0, v2, :cond_1
+    if-ne v0, v2, :cond_2
 
     iget-wide v3, p1, Lcom/android/systemui/shade/NotificationShadeWindowState;->keyguardUserActivityTimeout:J
 
@@ -467,16 +476,16 @@
 
     cmp-long p1, v3, v5
 
-    if-gez p1, :cond_2
+    if-gez p1, :cond_3
 
     move-wide v3, v5
 
     goto :goto_0
 
-    :cond_1
+    :cond_2
     const-wide/16 v3, -0x1
 
-    :cond_2
+    :cond_3
     :goto_0
     iput-wide v3, v1, Landroid/view/WindowManager$LayoutParams;->userActivityTimeout:J
 
@@ -490,13 +499,13 @@
 
     sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_PUNCH_HOLE_FACE_VI:Z
 
-    if-eqz p1, :cond_3
+    if-eqz p1, :cond_4
 
     iput v2, v1, Landroid/view/WindowManager$LayoutParams;->layoutInDisplayCutoutMode:I
 
     goto :goto_1
 
-    :cond_3
+    :cond_4
     const/4 p1, 0x3
 
     iput p1, v1, Landroid/view/WindowManager$LayoutParams;->layoutInDisplayCutoutMode:I
diff --git a/smali_classes3/com/android/systemui/statusbar/phone/CentralSurfacesImpl.smali b/smali_classes3/com/android/systemui/statusbar/phone/CentralSurfacesImpl.smali
index 0e624a87d..754077058 100644
--- a/smali_classes3/com/android/systemui/statusbar/phone/CentralSurfacesImpl.smali
+++ b/smali_classes3/com/android/systemui/statusbar/phone/CentralSurfacesImpl.smali
@@ -5800,19 +5800,30 @@
 
     iput-object v4, v0, Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl;->mLp:Landroid/view/WindowManager$LayoutParams;
 
-    sget-object v9, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    sget-boolean v9, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
 
+    if-eqz v9, :cond_32
+
+    iget v9, v4, Landroid/view/WindowManager$LayoutParams;->samsungFlags:I
+
+    const/high16 v10, 0x20000
+
+    or-int/2addr v9, v10
+
+    iput v9, v4, Landroid/view/WindowManager$LayoutParams;->samsungFlags:I
+
+    :cond_32
     iget-object v9, v0, Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl;->mIndicatorCutoutUtil:Lcom/android/systemui/statusbar/phone/IndicatorCutoutUtil;
 
     iget-boolean v9, v9, Lcom/android/systemui/statusbar/phone/IndicatorCutoutUtil;->isUDCModel:Z
 
-    if-eqz v9, :cond_32
+    if-eqz v9, :cond_33
 
     const/16 v9, 0x2000
 
     invoke-virtual {v4, v9}, Landroid/view/WindowManager$LayoutParams;->semAddExtensionFlags(I)V
 
-    :cond_32
+    :cond_33
     iget-object v4, v0, Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl;->mWindowManager:Landroid/view/WindowManager;
 
     iget-object v9, v0, Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl;->mWindowRootView:Lcom/android/systemui/scene/ui/view/WindowRootView;
@@ -5827,7 +5838,7 @@
 
     move-result-object v4
 
-    if-eqz v4, :cond_33
+    if-eqz v4, :cond_34
 
     iget-object v4, v0, Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl;->mWindowRootView:Lcom/android/systemui/scene/ui/view/WindowRootView;
 
@@ -5839,7 +5850,7 @@
 
     invoke-interface {v4, v11}, Landroid/view/WindowInsetsController;->setSystemBarsBehavior(I)V
 
-    :cond_33
+    :cond_34
     iget-object v4, v0, Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl;->mLpChanged:Landroid/view/WindowManager$LayoutParams;
 
     iget-object v9, v0, Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl;->mLp:Landroid/view/WindowManager$LayoutParams;
@@ -5854,7 +5865,7 @@
 
     move-result v4
 
-    if-eqz v4, :cond_34
+    if-eqz v4, :cond_35
 
     const/4 v4, 0x1
 
@@ -5862,7 +5873,7 @@
 
     goto :goto_c
 
-    :cond_34
+    :cond_35
     const/4 v4, 0x1
 
     :goto_c
@@ -5874,14 +5885,14 @@
 
     iget-object v4, v0, Lcom/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl;->pluginLockMediator:Lcom/android/systemui/pluginlock/PluginLockMediator;
 
-    if-eqz v4, :cond_35
+    if-eqz v4, :cond_36
 
     iget-object v10, v0, Lcom/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl;->notificationShadeView:Lcom/android/systemui/scene/ui/view/WindowRootView;
 
     invoke-interface {v4, v10}, Lcom/android/systemui/pluginlock/PluginLockMediator;->onRootViewAttached(Landroid/view/ViewGroup;)V
 
-    :cond_35
-    if-eqz v4, :cond_36
+    :cond_36
+    if-eqz v4, :cond_37
 
     new-instance v10, Lcom/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl$attach$1;
 
@@ -5889,7 +5900,7 @@
 
     invoke-interface {v4, v10}, Lcom/android/systemui/pluginlock/PluginLockMediator;->setNoSensorConsumer(Ljava/util/function/Consumer;)V
 
-    :cond_36
+    :cond_37
     new-instance v4, Lcom/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl$attach$2;
 
     invoke-direct {v4, v0}, Lcom/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl$attach$2;-><init>(Lcom/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl;)V
@@ -5979,7 +5990,7 @@
     :goto_d
     const/4 v14, 0x3
 
-    if-gt v9, v14, :cond_37
+    if-gt v9, v14, :cond_38
 
     iget-object v10, v0, Landroid/view/WindowManager$LayoutParams;->paramsForRotation:[Landroid/view/WindowManager$LayoutParams;
 
@@ -5995,7 +6006,7 @@
 
     goto :goto_d
 
-    :cond_37
+    :cond_38
     iput-object v0, v4, Lcom/android/systemui/statusbar/window/StatusBarWindowControllerImpl;->mLp:Landroid/view/WindowManager$LayoutParams;
 
     invoke-static {}, Landroid/os/Trace;->endSection()V
@@ -6085,7 +6096,7 @@
 
     iget-object v0, v9, Lcom/android/systemui/statusbar/NotificationRemoteInputManager;->mRemoteInputController:Lcom/android/systemui/statusbar/RemoteInputController;
 
-    if-eqz v0, :cond_38
+    if-eqz v0, :cond_39
 
     invoke-static {v2}, Ljava/util/Objects;->requireNonNull(Ljava/lang/Object;)Ljava/lang/Object;
 
@@ -6095,7 +6106,7 @@
 
     goto :goto_f
 
-    :cond_38
+    :cond_39
     iget-object v0, v9, Lcom/android/systemui/statusbar/NotificationRemoteInputManager;->mControllerCallbacks:Ljava/util/List;
 
     check-cast v0, Ljava/util/ArrayList;
@@ -6157,7 +6168,7 @@
 
     sget-boolean v2, Lcom/android/systemui/NotiRune;->NOTI_SUBSCREEN_ALL:Z
 
-    if-eqz v2, :cond_39
+    if-eqz v2, :cond_3a
 
     const-class v2, Lcom/android/systemui/statusbar/notification/SubscreenNotificationController;
 
@@ -6179,11 +6190,11 @@
 
     iget-object v2, v2, Lcom/android/systemui/statusbar/notification/SubscreenNotificationController;->mDeviceModel:Lcom/android/systemui/statusbar/notification/SubscreenDeviceModelParent;
 
-    if-eqz v2, :cond_39
+    if-eqz v2, :cond_3a
 
     iput-object v0, v2, Lcom/android/systemui/statusbar/notification/SubscreenDeviceModelParent;->mNotificationActivityStarter:Lcom/android/systemui/statusbar/notification/NotificationActivityStarter;
 
-    :cond_39
+    :cond_3a
     iget v0, v7, Lcom/android/internal/statusbar/RegisterStatusBarResult;->mTransientBarTypes:I
 
     invoke-static {}, Landroid/view/WindowInsets$Type;->statusBars()I
@@ -6192,7 +6203,7 @@
 
     and-int/2addr v0, v2
 
-    if-eqz v0, :cond_3b
+    if-eqz v0, :cond_3c
 
     invoke-interface/range {v17 .. v17}, Lcom/android/systemui/display/data/repository/PerDisplayStore;->getDefaultDisplay()Ljava/lang/Object;
 
@@ -6214,7 +6225,7 @@
 
     check-cast v2, Lcom/android/systemui/statusbar/phone/CentralSurfaces;
 
-    if-eqz v2, :cond_3a
+    if-eqz v2, :cond_3b
 
     check-cast v2, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;
 
@@ -6222,7 +6233,7 @@
 
     iput-boolean v4, v2, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mNoAnimationOnNextBarModeChange:Z
 
-    :cond_3a
+    :cond_3b
     sget-object v2, Ljava/lang/Boolean;->TRUE:Ljava/lang/Boolean;
 
     iget-object v0, v0, Lcom/android/systemui/statusbar/data/repository/StatusBarModePerDisplayRepositoryImpl;->_isTransientShown:Lkotlinx/coroutines/flow/StateFlowImpl;
@@ -6231,7 +6242,7 @@
 
     invoke-virtual {v0, v12, v2}, Lkotlinx/coroutines/flow/StateFlowImpl;->updateState(Ljava/lang/Object;Ljava/lang/Object;)Z
 
-    :cond_3b
+    :cond_3c
     iget-object v0, v1, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mCommandQueueCallbacks:Lcom/android/systemui/statusbar/phone/CentralSurfacesCommandQueueCallbacks;
 
     invoke-virtual {v0}, Ljava/lang/Object;->getClass()Ljava/lang/Class;
@@ -6249,7 +6260,7 @@
     const/4 v2, 0x0
 
     :goto_10
-    if-ge v2, v0, :cond_3c
+    if-ge v2, v0, :cond_3d
 
     iget-object v3, v7, Lcom/android/internal/statusbar/RegisterStatusBarResult;->mIcons:Landroid/util/ArrayMap;
 
@@ -6275,10 +6286,10 @@
 
     goto :goto_10
 
-    :cond_3c
+    :cond_3d
     iget-boolean v0, v1, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mWallpaperSupported:Z
 
-    if-eqz v0, :cond_3d
+    if-eqz v0, :cond_3e
 
     const-string/jumbo v0, "wallpaper"
 
@@ -6300,7 +6311,7 @@
     .catch Landroid/os/RemoteException; {:try_start_2 .. :try_end_2} :catch_2
 
     :catch_2
-    :cond_3d
+    :cond_3e
     iget-object v0, v1, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mIconPolicy:Lcom/android/systemui/statusbar/phone/PhoneStatusBarPolicy;
 
     invoke-virtual {v0}, Lcom/android/systemui/statusbar/phone/PhoneStatusBarPolicy;->init()V
@@ -6406,16 +6417,16 @@
 
     move-result v3
 
-    if-nez v3, :cond_3e
+    if-nez v3, :cond_3f
 
     iget-object v3, v2, Lcom/android/systemui/statusbar/phone/BiometricUnlockController;->mUpdateMonitor:Lcom/android/keyguard/KeyguardUpdateMonitor;
 
     invoke-interface {v3, v2}, Lcom/android/keyguard/KeyguardSecUpdateMonitor;->registerPreCallback(Lcom/android/keyguard/KeyguardUpdateMonitorCallback;)V
 
-    :cond_3e
+    :cond_3f
     iget-object v2, v9, Lcom/android/systemui/statusbar/NotificationRemoteInputManager;->mRemoteInputController:Lcom/android/systemui/statusbar/RemoteInputController;
 
-    if-eqz v2, :cond_3f
+    if-eqz v2, :cond_40
 
     invoke-static {v0}, Ljava/util/Objects;->requireNonNull(Ljava/lang/Object;)Ljava/lang/Object;
 
@@ -6425,7 +6436,7 @@
 
     goto :goto_11
 
-    :cond_3f
+    :cond_40
     iget-object v2, v9, Lcom/android/systemui/statusbar/NotificationRemoteInputManager;->mControllerCallbacks:Ljava/util/List;
 
     check-cast v2, Ljava/util/ArrayList;
@@ -6435,14 +6446,14 @@
     :goto_11
     sget-boolean v2, Lcom/android/systemui/LsRune;->SECURITY_DEFAULT_LANDSCAPE:Z
 
-    if-eqz v2, :cond_40
+    if-eqz v2, :cond_41
 
     invoke-static {}, Lcom/android/systemui/util/DeviceState;->setLandscapeDefaultRotation()V
 
-    :cond_40
+    :cond_41
     sget-boolean v2, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY:Z
 
-    if-eqz v2, :cond_41
+    if-eqz v2, :cond_42
 
     iget-object v2, v1, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mContext:Landroid/content/Context;
 
@@ -6456,7 +6467,7 @@
 
     invoke-static {v2}, Lcom/android/systemui/util/DeviceState;->setInDisplayFingerprintSensorPosition(Landroid/util/DisplayMetrics;)V
 
-    :cond_41
+    :cond_42
     invoke-static {}, Landroid/os/Trace;->endSection()V
 
     iget-object v2, v1, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mUpdateCallback:Lcom/android/keyguard/KeyguardUpdateMonitorCallback;
@@ -6485,18 +6496,18 @@
 
     iget-object v0, v1, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mLightRevealScrim:Lcom/android/systemui/statusbar/LightRevealScrim;
 
-    if-nez v0, :cond_42
+    if-nez v0, :cond_43
 
     goto :goto_12
 
-    :cond_42
+    :cond_43
     sget-boolean v2, Lcom/android/systemui/LsRune;->AOD_LIGHT_REVEAL:Z
 
-    if-nez v2, :cond_43
+    if-nez v2, :cond_44
 
     invoke-virtual {v0, v8}, Lcom/android/systemui/statusbar/LightRevealScrim;->setVisibility(I)V
 
-    :cond_43
+    :cond_44
     :goto_12
     iget-object v0, v1, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mConfigurationListener:Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl$16;
 
@@ -6536,7 +6547,7 @@
 
     iget-boolean v2, v0, Lcom/android/systemui/InitController;->mTasksExecuted:Z
 
-    if-nez v2, :cond_45
+    if-nez v2, :cond_46
 
     iget-object v0, v0, Lcom/android/systemui/InitController;->mTasks:Ljava/util/ArrayList;
 
@@ -6618,7 +6629,7 @@
 
     sget-boolean v0, Lcom/android/systemui/LsRune;->AOD_LIGHT_REVEAL:Z
 
-    if-eqz v0, :cond_44
+    if-eqz v0, :cond_45
 
     iget-object v0, v1, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mSecLightRevealScrimHelper:Lcom/android/systemui/statusbar/SecLightRevealScrimHelper;
 
@@ -6690,10 +6701,10 @@
 
     invoke-static/range {v5 .. v12}, Lcom/android/systemui/broadcast/BroadcastDispatcher;->registerReceiver$default(Lcom/android/systemui/broadcast/BroadcastDispatcher;Landroid/content/BroadcastReceiver;Landroid/content/IntentFilter;Ljava/util/concurrent/Executor;Landroid/os/UserHandle;ILjava/lang/String;I)V
 
-    :cond_44
+    :cond_45
     return-void
 
-    :cond_45
+    :cond_46
     new-instance v0, Ljava/lang/IllegalStateException;
 
     const-string/jumbo v1, "post init tasks have already been executed!"
diff --git a/smali_classes3/com/android/systemui/util/DeviceState.smali b/smali_classes3/com/android/systemui/util/DeviceState.smali
index 0ea059938..fd4acfdd9 100644
--- a/smali_classes3/com/android/systemui/util/DeviceState.smali
+++ b/smali_classes3/com/android/systemui/util/DeviceState.smali
@@ -1176,21 +1176,47 @@
     :catchall_0
     move-exception v1
 
-    goto :goto_1
+    goto :goto_3
 
     :cond_0
     :goto_0
-    sget-object v1, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    sget-boolean v1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz v1, :cond_2
+
+    sget-object v1, Lcom/android/systemui/util/DeviceState;->sDisplaySize:Landroid/graphics/Point;
+
+    iget v2, v1, Landroid/graphics/Point;->x:I
+
+    iget v1, v1, Landroid/graphics/Point;->y:I
+
+    invoke-static {v2, v1}, Ljava/lang/Math;->min(II)I
+
+    move-result v1
     :try_end_0
     .catchall {:try_start_0 .. :try_end_0} :catchall_0
 
-    monitor-exit v0
+    const/16 v2, 0x2d0
 
-    const/4 v0, 0x1
+    if-le v1, v2, :cond_1
 
-    return v0
+    goto :goto_1
 
+    :cond_1
+    const/4 v1, 0x0
+
+    goto :goto_2
+
+    :cond_2
     :goto_1
+    const/4 v1, 0x1
+
+    :goto_2
+    monitor-exit v0
+
+    return v1
+
+    :goto_3
     :try_start_1
     monitor-exit v0
     :try_end_1
diff --git a/smali_classes3/com/android/systemui/util/DeviceType.smali b/smali_classes3/com/android/systemui/util/DeviceType.smali
index f63ab233d..9e69885fa 100644
--- a/smali_classes3/com/android/systemui/util/DeviceType.smali
+++ b/smali_classes3/com/android/systemui/util/DeviceType.smali
@@ -819,7 +819,7 @@
 
     const/4 v1, -0x1
 
-    const/4 v2, 0x0
+    const/4 v2, 0x1
 
     if-ne v0, v1, :cond_0
 
@@ -828,14 +828,14 @@
     :cond_0
     sget v0, Lcom/android/systemui/util/DeviceType;->supportOpticalFingerprint:I
 
-    const/4 v1, 0x1
-
-    if-ne v0, v1, :cond_1
+    if-ne v0, v2, :cond_1
 
-    return v1
+    return v2
 
     :cond_1
-    return v2
+    const/4 v0, 0x0
+
+    return v0
 .end method
 
 .method public static isQcomChipType()Z
-- 
2.51.0

