From 140643cfc67964e64c89fdec21fe94803e784f99 Mon Sep 17 00:00:00 2001
From: Salvo Giangreco <giangrecosalvo9@gmail.com>
Date: Sat, 11 Oct 2025 01:25:20 +0200
Subject: [PATCH] Enable FP_FEATURE_NO_DELAY_IN_SCREEN_OFF

---
 .../biometrics/app/setting/SysUiUdfpsOpticalManager.smali    | 5 +++++
 .../android/biometrics/app/setting/Utils$Config.smali        | 4 ++++
 2 files changed, 9 insertions(+)

diff --git a/smali/com/samsung/android/biometrics/app/setting/SysUiUdfpsOpticalManager.smali b/smali/com/samsung/android/biometrics/app/setting/SysUiUdfpsOpticalManager.smali
index 4238f63..2aa5fe1 100644
--- a/smali/com/samsung/android/biometrics/app/setting/SysUiUdfpsOpticalManager.smali
+++ b/smali/com/samsung/android/biometrics/app/setting/SysUiUdfpsOpticalManager.smali
@@ -181,6 +181,10 @@
 
     if-eqz v1, :cond_1
 
+    sget-boolean v1, Lcom/samsung/android/biometrics/app/setting/Utils$Config;->FP_FEATURE_NO_DELAY_IN_SCREEN_OFF:Z
+
+    if-nez v1, :cond_4
+
     invoke-virtual {v0}, Lcom/samsung/android/biometrics/app/setting/fingerprint/OpticalController;->removeKeyguardMaskClientIfExist()V
 
     goto :goto_0
@@ -200,6 +204,7 @@
 
     invoke-virtual {v0}, Ljava/lang/Object;->getClass()Ljava/lang/Class;
 
+    :cond_4
     :goto_0
     invoke-super {p0, p1, p2}, Lcom/samsung/android/biometrics/app/setting/SysUiManager;->handleAuthenticationSucceeded(ILjava/lang/String;)V
 
diff --git a/smali/com/samsung/android/biometrics/app/setting/Utils$Config.smali b/smali/com/samsung/android/biometrics/app/setting/Utils$Config.smali
index aadb739..864acb6 100644
--- a/smali/com/samsung/android/biometrics/app/setting/Utils$Config.smali
+++ b/smali/com/samsung/android/biometrics/app/setting/Utils$Config.smali
@@ -44,6 +44,8 @@
 
 .field public static final FP_FEATURE_LOCAL_HBM:Z
 
+.field public static final FP_FEATURE_NO_DELAY_IN_SCREEN_OFF:Z
+
 .field public static final FP_FEATURE_SENSOR_IS_IN_DISPLAY_TYPE:Z
 
 .field public static final FP_FEATURE_SENSOR_IS_OPTICAL:Z
@@ -209,6 +211,8 @@
     :goto_3
     sput-boolean v4, Lcom/samsung/android/biometrics/app/setting/Utils$Config;->FP_FEATURE_HW_LIGHT_SOURCE:Z
 
+    sput-boolean v2, Lcom/samsung/android/biometrics/app/setting/Utils$Config;->FP_FEATURE_NO_DELAY_IN_SCREEN_OFF:Z
+
     sput-boolean v1, Lcom/samsung/android/biometrics/app/setting/Utils$Config;->FP_FEATURE_TSP_BLOCK:Z
 
     sput-boolean v2, Lcom/samsung/android/biometrics/app/setting/Utils$Config;->FP_FEATURE_ENROLL_FRAME_MOVING_UX:Z
-- 
2.51.0

