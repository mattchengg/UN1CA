From 14985011d0ee326d81e4622e35dd607d6770758e Mon Sep 17 00:00:00 2001
From: Salvo Giangreco <giangrecosalvo9@gmail.com>
Date: Sat, 1 Nov 2025 21:32:44 +0100
Subject: [PATCH] Disable 80211AX support

---
 .../wifi/ap/SemSoftApConfiguration.smali      | 38 ++++++++++++++++++-
 ...iApChipInfo$SemWifiApChipSupportInfo.smali | 10 +++++
 .../server/wifi/ap/SemWifiApChipInfo.smali    | 28 ++++++++++----
 3 files changed, 66 insertions(+), 10 deletions(-)

diff --git a/smali/com/samsung/android/server/wifi/ap/SemSoftApConfiguration.smali b/smali/com/samsung/android/server/wifi/ap/SemSoftApConfiguration.smali
index c2e8fc7..33bc78f 100644
--- a/smali/com/samsung/android/server/wifi/ap/SemSoftApConfiguration.smali
+++ b/smali/com/samsung/android/server/wifi/ap/SemSoftApConfiguration.smali
@@ -1919,7 +1919,7 @@
 .end method
 
 .method public static showSecProductFeature()Ljava/lang/String;
-    .locals 3
+    .locals 5
 
     new-instance v0, Ljava/lang/StringBuffer;
 
@@ -1951,7 +1951,41 @@
 
     invoke-virtual {v0, v1}, Ljava/lang/StringBuffer;->append(Ljava/lang/String;)Ljava/lang/StringBuffer;
 
-    const-string v1, "SPF_Enhanced=true\nSPF_Enhanced_Menu=d2d\nSPF_Guest=lite\nSPF_MobileAp=true\nSPF_Concurrency=false\nSPF_11ax=true\nSPF_6G=false\nSPF_Dongle=false\nSPF_DualAp=false\nSPF_MCF_AutoHotspot=false\nSPF_OWE=false\nSPF_Prio_Traffic=true\nSPF_WS_Lite=false\nSPF_wpa3=true\nSPF_JDM=in_house\n"
+    const-string v1, "SPF_Enhanced=true\nSPF_Enhanced_Menu=d2d\nSPF_Guest=lite\nSPF_MobileAp=true\nSPF_Concurrency=false\n"
+
+    invoke-virtual {v0, v1}, Ljava/lang/StringBuffer;->append(Ljava/lang/String;)Ljava/lang/StringBuffer;
+
+    new-instance v1, Ljava/lang/StringBuilder;
+
+    const-string v3, "SPF_11ax="
+
+    invoke-direct {v1, v3}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
+
+    invoke-static {}, Lcom/samsung/android/server/wifi/SemWifiInjector;->getInstance()Lcom/samsung/android/server/wifi/SemWifiInjector;
+
+    move-result-object v3
+
+    invoke-virtual {v3}, Lcom/samsung/android/server/wifi/SemWifiInjector;->getWifiApChipInfo()Lcom/samsung/android/server/wifi/ap/SemWifiApChipInfo;
+
+    move-result-object v3
+
+    const/4 v4, 0x1
+
+    invoke-virtual {v3, v4}, Lcom/samsung/android/server/wifi/ap/SemWifiApChipInfo;->supportThisSoftApFeature(I)Z
+
+    move-result v3
+
+    invoke-virtual {v1, v3}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
+
+    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v1
+
+    invoke-virtual {v0, v1}, Ljava/lang/StringBuffer;->append(Ljava/lang/String;)Ljava/lang/StringBuffer;
+
+    const-string v1, "SPF_6G=false\nSPF_Dongle=false\nSPF_DualAp=false\nSPF_MCF_AutoHotspot=false\nSPF_OWE=false\nSPF_Prio_Traffic=true\nSPF_WS_Lite=false\nSPF_wpa3=true\nSPF_JDM=in_house\n"
 
     invoke-virtual {v0, v1}, Ljava/lang/StringBuffer;->append(Ljava/lang/String;)Ljava/lang/StringBuffer;
 
diff --git a/smali/com/samsung/android/server/wifi/ap/SemWifiApChipInfo$SemWifiApChipSupportInfo.smali b/smali/com/samsung/android/server/wifi/ap/SemWifiApChipInfo$SemWifiApChipSupportInfo.smali
index 9cd079b..8b16bc2 100644
--- a/smali/com/samsung/android/server/wifi/ap/SemWifiApChipInfo$SemWifiApChipSupportInfo.smali
+++ b/smali/com/samsung/android/server/wifi/ap/SemWifiApChipInfo$SemWifiApChipSupportInfo.smali
@@ -27,6 +27,16 @@
 
 
 # direct methods
+.method static bridge synthetic -$$Nest$misSupportedSoftAp11ax(Lcom/samsung/android/server/wifi/ap/SemWifiApChipInfo$SemWifiApChipSupportInfo;)Z
+    .locals 0
+
+    invoke-direct {p0}, Lcom/samsung/android/server/wifi/ap/SemWifiApChipInfo$SemWifiApChipSupportInfo;->isSupportedSoftAp11ax()Z
+
+    move-result p0
+
+    return p0
+.end method
+
 .method static bridge synthetic -$$Nest$misSupportedSoftApPowerSave(Lcom/samsung/android/server/wifi/ap/SemWifiApChipInfo$SemWifiApChipSupportInfo;)Z
     .locals 0
 
diff --git a/smali/com/samsung/android/server/wifi/ap/SemWifiApChipInfo.smali b/smali/com/samsung/android/server/wifi/ap/SemWifiApChipInfo.smali
index 4e9fa28..bc63390 100644
--- a/smali/com/samsung/android/server/wifi/ap/SemWifiApChipInfo.smali
+++ b/smali/com/samsung/android/server/wifi/ap/SemWifiApChipInfo.smali
@@ -1737,11 +1737,11 @@
 .end method
 
 .method public supportThisSoftApFeature(I)Z
-    .locals 3
+    .locals 2
 
     const/4 v0, 0x1
 
-    if-eq p1, v0, :cond_2
+    if-eq p1, v0, :cond_1
 
     const/4 v1, 0x2
 
@@ -1749,11 +1749,9 @@
 
     const/4 v1, 0x3
 
-    const/4 v2, 0x0
-
     if-eq p1, v1, :cond_0
 
-    return v2
+    goto :goto_1
 
     :cond_0
     iget-boolean p1, p0, Lcom/samsung/android/server/wifi/ap/SemWifiApChipInfo;->mSupportPowerSave:Z
@@ -1762,22 +1760,36 @@
 
     iget-object p0, p0, Lcom/samsung/android/server/wifi/ap/SemWifiApChipInfo;->mSemWifiApChipSupportInfo:Lcom/samsung/android/server/wifi/ap/SemWifiApChipInfo$SemWifiApChipSupportInfo;
 
-    if-eqz p0, :cond_1
+    if-eqz p0, :cond_3
 
     invoke-static {p0}, Lcom/samsung/android/server/wifi/ap/SemWifiApChipInfo$SemWifiApChipSupportInfo;->-$$Nest$misSupportedSoftApPowerSave(Lcom/samsung/android/server/wifi/ap/SemWifiApChipInfo$SemWifiApChipSupportInfo;)Z
 
     move-result p0
 
-    if-eqz p0, :cond_1
+    if-eqz p0, :cond_3
 
     goto :goto_0
 
     :cond_1
-    return v2
+    iget-object p0, p0, Lcom/samsung/android/server/wifi/ap/SemWifiApChipInfo;->mSemWifiApChipSupportInfo:Lcom/samsung/android/server/wifi/ap/SemWifiApChipInfo$SemWifiApChipSupportInfo;
+
+    if-eqz p0, :cond_3
+
+    invoke-static {p0}, Lcom/samsung/android/server/wifi/ap/SemWifiApChipInfo$SemWifiApChipSupportInfo;->-$$Nest$misSupportedSoftAp11ax(Lcom/samsung/android/server/wifi/ap/SemWifiApChipInfo$SemWifiApChipSupportInfo;)Z
+
+    move-result p0
+
+    if-eqz p0, :cond_3
 
     :cond_2
     :goto_0
     return v0
+
+    :cond_3
+    :goto_1
+    const/4 p0, 0x0
+
+    return p0
 .end method
 
 .method public supportWifiSharing()Z
-- 
2.51.1

