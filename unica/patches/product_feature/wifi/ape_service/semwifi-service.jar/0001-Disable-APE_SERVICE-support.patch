From 6ee11b51579b0c9fcda0017b3929ec0bfc4e921a Mon Sep 17 00:00:00 2001
From: Salvo Giangreco <giangrecosalvo9@gmail.com>
Date: Sun, 12 Oct 2025 16:27:45 +0200
Subject: [PATCH] Disable APE_SERVICE support

UN1CA: this patch is not complete! Please check unica/patches/product_feature/customize.sh for more info.
---
 .../server/wifi/SemQboxController.smali       |  49 +---
 .../android/server/wifi/SemWifiInjector.smali | 264 +++++-------------
 ...emWifiShellCommand$SqeCommandHandler.smali |   2 +-
 3 files changed, 78 insertions(+), 237 deletions(-)

diff --git a/smali/com/samsung/android/server/wifi/SemQboxController.smali b/smali/com/samsung/android/server/wifi/SemQboxController.smali
index 9b3cdaf..3feb14f 100644
--- a/smali/com/samsung/android/server/wifi/SemQboxController.smali
+++ b/smali/com/samsung/android/server/wifi/SemQboxController.smali
@@ -110,14 +110,6 @@
     return-void
 .end method
 
-.method static bridge synthetic -$$Nest$fgetmContext(Lcom/samsung/android/server/wifi/SemQboxController;)Landroid/content/Context;
-    .locals 0
-
-    iget-object p0, p0, Lcom/samsung/android/server/wifi/SemQboxController;->mContext:Landroid/content/Context;
-
-    return-object p0
-.end method
-
 .method static bridge synthetic -$$Nest$fgetmHandler(Lcom/samsung/android/server/wifi/SemQboxController;)Landroid/os/Handler;
     .locals 0
 
@@ -1374,41 +1366,9 @@
 .end method
 
 .method registerContentObserver(Lcom/samsung/android/server/wifi/SemFrameworkFacade;)V
-    .locals 5
-
-    iget-object v0, p0, Lcom/samsung/android/server/wifi/SemQboxController;->mContext:Landroid/content/Context;
-
-    const/4 v1, 0x1
-
-    const-string v2, "sem_wifi_ape_enabled"
-
-    invoke-virtual {p1, v0, v2, v1}, Lcom/samsung/android/server/wifi/SemFrameworkFacade;->getIntegerSetting(Landroid/content/Context;Ljava/lang/String;I)I
-
-    move-result v0
-
-    iget-object v1, p0, Lcom/samsung/android/server/wifi/SemQboxController;->mContext:Landroid/content/Context;
-
-    invoke-static {v2}, Landroid/provider/Settings$Global;->getUriFor(Ljava/lang/String;)Landroid/net/Uri;
-
-    move-result-object v2
-
-    new-instance v3, Lcom/samsung/android/server/wifi/SemQboxController$1;
-
-    const/4 v4, 0x0
-
-    invoke-direct {v3, p0, v4, p1}, Lcom/samsung/android/server/wifi/SemQboxController$1;-><init>(Lcom/samsung/android/server/wifi/SemQboxController;Landroid/os/Handler;Lcom/samsung/android/server/wifi/SemFrameworkFacade;)V
-
-    const/4 v4, 0x0
-
-    invoke-virtual {p1, v1, v2, v4, v3}, Lcom/samsung/android/server/wifi/SemFrameworkFacade;->registerContentObserver(Landroid/content/Context;Landroid/net/Uri;ZLandroid/database/ContentObserver;)V
-
-    if-nez v0, :cond_0
-
-    const-string p1, "MSCS in Settings is "
-
-    invoke-static {v0, p1}, Lcom/samsung/android/mcf/continuity/common/VersionUtil$$ExternalSyntheticOutline0;->m(ILjava/lang/String;)Ljava/lang/String;
+    .locals 1
 
-    move-result-object p1
+    const-string p1, "MSCS in Settings is 0"
 
     invoke-static {p1}, Lcom/samsung/android/server/wifi/SemQboxController;->logi(Ljava/lang/String;)V
 
@@ -1416,13 +1376,14 @@
 
     const/4 p1, 0x5
 
-    invoke-virtual {p0, p1, v4, v4}, Landroid/os/Handler;->obtainMessage(III)Landroid/os/Message;
+    const/4 v0, 0x0
+
+    invoke-virtual {p0, p1, v0, v0}, Landroid/os/Handler;->obtainMessage(III)Landroid/os/Message;
 
     move-result-object p1
 
     invoke-virtual {p0, p1}, Landroid/os/Handler;->sendMessage(Landroid/os/Message;)Z
 
-    :cond_0
     return-void
 .end method
 
diff --git a/smali/com/samsung/android/server/wifi/SemWifiInjector.smali b/smali/com/samsung/android/server/wifi/SemWifiInjector.smali
index eb567f9..90630b2 100644
--- a/smali/com/samsung/android/server/wifi/SemWifiInjector.smali
+++ b/smali/com/samsung/android/server/wifi/SemWifiInjector.smali
@@ -309,7 +309,7 @@
 
 # direct methods
 .method public constructor <init>(Landroid/content/Context;)V
-    .locals 28
+    .locals 29
 
     move-object/from16 v4, p0
 
@@ -323,11 +323,11 @@
 
     iput-object v10, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mClock:Lcom/samsung/android/server/wifi/util/SemClock;
 
-    if-eqz v1, :cond_a
+    if-eqz v1, :cond_8
 
     sget-object v0, Lcom/samsung/android/server/wifi/SemWifiInjector;->sWifiInjector:Lcom/samsung/android/server/wifi/SemWifiInjector;
 
-    if-nez v0, :cond_9
+    if-nez v0, :cond_7
 
     sput-object v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->sWifiInjector:Lcom/samsung/android/server/wifi/SemWifiInjector;
 
@@ -449,13 +449,13 @@
 
     invoke-direct {v5, v15, v3}, Lcom/samsung/android/server/wifi/util/FeatureUtil;-><init>(Lcom/samsung/android/server/wifi/SemFrameworkFacade;Landroid/net/wifi/WifiManager;)V
 
-    move-object/from16 v27, v4
+    move-object/from16 v28, v4
 
     move-object v4, v3
 
     move-object v3, v7
 
-    move-object/from16 v7, v27
+    move-object/from16 v7, v28
 
     invoke-direct/range {v0 .. v7}, Lcom/samsung/android/server/wifi/SemWifiManagerProxy;-><init>(Landroid/content/Context;Landroid/os/HandlerExecutor;Lcom/samsung/android/server/wifi/SemWifiThreadRunner;Landroid/net/wifi/WifiManager;Lcom/samsung/android/server/wifi/util/FeatureUtil;Lcom/samsung/android/server/wifi/util/ScanPool;Lcom/samsung/android/server/wifi/SemWifiInjector;)V
 
@@ -641,23 +641,23 @@
 
     iput-object v4, v0, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiBackOffController:Lcom/samsung/android/server/wifi/backoff/WifiBackOffController;
 
-    new-instance v4, Lcom/samsung/android/server/wifi/abtest/AbTestManager;
+    new-instance v5, Lcom/samsung/android/server/wifi/abtest/AbTestManager;
 
-    invoke-direct {v4, v1, v6, v0}, Lcom/samsung/android/server/wifi/abtest/AbTestManager;-><init>(Landroid/content/Context;Landroid/os/Handler;Lcom/samsung/android/server/wifi/SemWifiInjector;)V
+    invoke-direct {v5, v1, v6, v0}, Lcom/samsung/android/server/wifi/abtest/AbTestManager;-><init>(Landroid/content/Context;Landroid/os/Handler;Lcom/samsung/android/server/wifi/SemWifiInjector;)V
 
-    iput-object v4, v0, Lcom/samsung/android/server/wifi/SemWifiInjector;->mAbTestManager:Lcom/samsung/android/server/wifi/abtest/AbTestManager;
+    iput-object v5, v0, Lcom/samsung/android/server/wifi/SemWifiInjector;->mAbTestManager:Lcom/samsung/android/server/wifi/abtest/AbTestManager;
 
-    const-string v5, "WifiRouterInfoCollectorThread"
+    const-string v20, "WifiRouterInfoCollectorThread"
 
-    invoke-static {v5}, Lcom/samsung/android/server/wifi/SemPreScanResultProcessor$$ExternalSyntheticOutline0;->m(Ljava/lang/String;)Landroid/os/HandlerThread;
+    invoke-static/range {v20 .. v20}, Lcom/samsung/android/server/wifi/SemPreScanResultProcessor$$ExternalSyntheticOutline0;->m(Ljava/lang/String;)Landroid/os/HandlerThread;
 
-    move-result-object v5
+    move-result-object v20
 
-    move-object/from16 v20, v5
+    move-object/from16 v21, v5
 
     new-instance v5, Lcom/samsung/android/server/wifi/routerinfo/WifiRouterInfoCollector;
 
-    move-object/from16 v21, v2
+    move-object/from16 v22, v2
 
     invoke-virtual/range {v20 .. v20}, Landroid/os/HandlerThread;->getLooper()Landroid/os/Looper;
 
@@ -681,19 +681,19 @@
 
     move-object v2, v1
 
-    move-object v1, v12
+    move-object/from16 v24, v4
 
-    move-object v12, v4
+    move-object v1, v10
 
     move-object/from16 v4, v18
 
-    move-object/from16 v18, v1
+    move-object/from16 v23, v22
 
-    move-object v1, v10
+    move-object/from16 v10, p0
 
-    move-object/from16 v22, v21
+    move-object/from16 v18, v12
 
-    move-object/from16 v10, p0
+    move-object/from16 v12, v21
 
     invoke-direct/range {v0 .. v5}, Lcom/samsung/android/server/wifi/SemUserConnectionSaLogging;-><init>(Lcom/samsung/android/server/wifi/util/SemClock;Lcom/samsung/android/server/wifi/SemWifiConfigManager;Lcom/samsung/android/server/wifi/bigdata/SaLoggingManager;Lcom/samsung/android/server/wifi/driver/WifiDriverVersionProvider;Lcom/samsung/android/server/wifi/routerinfo/WifiRouterInfoCollector;)V
 
@@ -739,9 +739,9 @@
     :goto_0
     invoke-direct {v9, v5}, Landroid/util/LocalLog;-><init>(I)V
 
-    move-object/from16 v24, v4
+    move-object/from16 v26, v4
 
-    move-object/from16 v23, v6
+    move-object/from16 v25, v6
 
     move-object v10, v7
 
@@ -829,7 +829,7 @@
 
     move-result-object v5
 
-    move-object/from16 v10, v23
+    move-object/from16 v10, v25
 
     invoke-direct {v3, v5, v0, v1, v10}, Lcom/samsung/android/server/wifi/SemWifiCarrierInfoManager;-><init>(Landroid/telephony/TelephonyManager;Landroid/telephony/SubscriptionManager;Landroid/content/Context;Landroid/os/Handler;)V
 
@@ -851,7 +851,7 @@
 
     new-instance v5, Landroid/os/HandlerThread;
 
-    move-object/from16 v23, v2
+    move-object/from16 v22, v2
 
     const-string v2, "SemWifiServiceDetectionHandlerThread"
 
@@ -939,21 +939,21 @@
 
     new-instance v0, Lcom/samsung/android/server/wifi/SemWifiLnaControl;
 
-    move-object/from16 v27, v23
+    move-object/from16 v28, v22
 
-    move-object/from16 v23, v2
+    move-object/from16 v22, v2
 
-    move-object/from16 v2, v27
+    move-object/from16 v2, v28
 
-    move-object/from16 v27, v15
+    move-object/from16 v28, v15
 
     move-object v15, v3
 
-    move-object/from16 v3, v27
+    move-object/from16 v3, v28
 
     invoke-direct/range {v0 .. v5}, Lcom/samsung/android/server/wifi/SemWifiLnaControl;-><init>(Landroid/content/Context;Lcom/samsung/android/server/wifi/halclient/SemWifiNative;Landroid/net/wifi/WifiManager;Lcom/samsung/android/server/wifi/SemWifiInjector;Landroid/os/HandlerThread;)V
 
-    move-object/from16 v26, v3
+    move-object/from16 v27, v3
 
     iput-object v0, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiLnaControl:Lcom/samsung/android/server/wifi/SemWifiLnaControl;
 
@@ -1039,17 +1039,15 @@
 
     move-object/from16 v15, v19
 
-    move-object/from16 v5, v23
+    move-object/from16 v5, v22
 
     move-object/from16 v3, v25
 
     invoke-direct/range {v0 .. v8}, Lcom/samsung/android/server/wifi/SemWifiOptimizer;-><init>(Landroid/content/Context;Lcom/samsung/android/server/wifi/halclient/SemWifiNative;Lcom/samsung/android/server/wifi/SemWifiConfigManager;Lcom/samsung/android/server/wifi/SemWifiInjector;Lcom/samsung/android/server/wifi/SemWifiTrafficPoller;Lcom/samsung/android/server/wifi/util/ScanPool;Landroid/os/HandlerThread;Lcom/samsung/android/server/wifi/SemWifiServiceDetector;)V
 
-    move-object v7, v0
-
-    iput-object v7, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiOptimizer:Lcom/samsung/android/server/wifi/SemWifiOptimizer;
+    iput-object v0, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiOptimizer:Lcom/samsung/android/server/wifi/SemWifiOptimizer;
 
-    invoke-virtual {v12, v7}, Lcom/samsung/android/server/wifi/SemClientModeManager;->registerClientModeStateListener(Lcom/samsung/android/server/wifi/ClientModeStateListener;)V
+    invoke-virtual {v12, v0}, Lcom/samsung/android/server/wifi/SemClientModeManager;->registerClientModeStateListener(Lcom/samsung/android/server/wifi/ClientModeStateListener;)V
 
     const-string v0, "mWifiTwtControlHandlerThread start"
 
@@ -1105,7 +1103,7 @@
 
     invoke-direct/range {v0 .. v5}, Lcom/samsung/android/server/wifi/SemWifiTwtMonitor;-><init>(Landroid/content/Context;Lcom/samsung/android/server/wifi/halclient/SemWifiNative;Lcom/samsung/android/server/wifi/SemWifiInjector;Lcom/samsung/android/server/wifi/SemWifiTrafficPoller;Lcom/samsung/android/server/wifi/SemWifiServiceDetector;)V
 
-    move-object v8, v2
+    move-object v7, v2
 
     move-object v4, v3
 
@@ -1119,7 +1117,7 @@
 
     new-instance v0, Lcom/samsung/android/server/wifi/SemWifiMultiLinkControl;
 
-    invoke-direct {v0, v1, v8, v4}, Lcom/samsung/android/server/wifi/SemWifiMultiLinkControl;-><init>(Landroid/content/Context;Lcom/samsung/android/server/wifi/halclient/SemWifiNative;Lcom/samsung/android/server/wifi/SemWifiInjector;)V
+    invoke-direct {v0, v1, v7, v4}, Lcom/samsung/android/server/wifi/SemWifiMultiLinkControl;-><init>(Landroid/content/Context;Lcom/samsung/android/server/wifi/halclient/SemWifiNative;Lcom/samsung/android/server/wifi/SemWifiInjector;)V
 
     iput-object v0, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiMultiLinkControl:Lcom/samsung/android/server/wifi/SemWifiMultiLinkControl;
 
@@ -1157,7 +1155,7 @@
 
     new-instance v2, Lcom/samsung/android/server/wifi/SemWifiLinkInfoCollector;
 
-    invoke-direct {v2, v1, v15, v0, v8}, Lcom/samsung/android/server/wifi/SemWifiLinkInfoCollector;-><init>(Landroid/content/Context;Lcom/samsung/android/server/wifi/SemWifiManagerProxy;Landroid/os/HandlerThread;Lcom/samsung/android/server/wifi/halclient/SemWifiNative;)V
+    invoke-direct {v2, v1, v15, v0, v7}, Lcom/samsung/android/server/wifi/SemWifiLinkInfoCollector;-><init>(Landroid/content/Context;Lcom/samsung/android/server/wifi/SemWifiManagerProxy;Landroid/os/HandlerThread;Lcom/samsung/android/server/wifi/halclient/SemWifiNative;)V
 
     iput-object v2, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiLinkInfoCollector:Lcom/samsung/android/server/wifi/SemWifiLinkInfoCollector;
 
@@ -1257,7 +1255,7 @@
 
     new-instance v0, Lcom/samsung/android/server/wifi/ap/SemWifiApTrafficPoller;
 
-    invoke-direct {v0, v1, v8}, Lcom/samsung/android/server/wifi/ap/SemWifiApTrafficPoller;-><init>(Landroid/content/Context;Lcom/samsung/android/server/wifi/halclient/SemWifiNative;)V
+    invoke-direct {v0, v1, v7}, Lcom/samsung/android/server/wifi/ap/SemWifiApTrafficPoller;-><init>(Landroid/content/Context;Lcom/samsung/android/server/wifi/halclient/SemWifiNative;)V
 
     iput-object v0, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiApTrafficPoller:Lcom/samsung/android/server/wifi/ap/SemWifiApTrafficPoller;
 
@@ -1347,7 +1345,7 @@
 
     new-instance v2, Lcom/samsung/android/server/wifi/SemSwitchBoardService;
 
-    invoke-direct {v2, v1, v8, v9, v0}, Lcom/samsung/android/server/wifi/SemSwitchBoardService;-><init>(Landroid/content/Context;Lcom/samsung/android/server/wifi/halclient/SemWifiNative;Lcom/samsung/android/server/wifi/util/SemClock;Landroid/os/HandlerThread;)V
+    invoke-direct {v2, v1, v7, v9, v0}, Lcom/samsung/android/server/wifi/SemSwitchBoardService;-><init>(Landroid/content/Context;Lcom/samsung/android/server/wifi/halclient/SemWifiNative;Lcom/samsung/android/server/wifi/util/SemClock;Landroid/os/HandlerThread;)V
 
     iput-object v2, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mSwitchBoardService:Lcom/samsung/android/server/wifi/SemSwitchBoardService;
 
@@ -1363,7 +1361,7 @@
 
     move-result-object v3
 
-    move-object/from16 v5, v22
+    move-object/from16 v5, v23
 
     invoke-direct {v0, v2, v5, v3}, Lcom/samsung/android/server/wifi/SemConnectivityLogger;-><init>(Lcom/samsung/android/server/wifi/SemWifiManagerProxy;Lcom/samsung/android/server/wifi/halclient/SemWifiMonitor;Landroid/os/Looper;)V
 
@@ -1371,7 +1369,7 @@
 
     new-instance v0, Lcom/samsung/android/server/wifi/SemSupportedFeatureLogger;
 
-    move-object/from16 v2, v24
+    move-object/from16 v2, v26
 
     invoke-direct {v0, v1, v2}, Lcom/samsung/android/server/wifi/SemSupportedFeatureLogger;-><init>(Landroid/content/Context;Lcom/samsung/android/server/wifi/driver/WifiDriverNativeCommandHelper;)V
 
@@ -1401,7 +1399,7 @@
 
     move-object/from16 v6, v21
 
-    move-object/from16 v3, v26
+    move-object/from16 v3, v27
 
     invoke-direct/range {v0 .. v6}, Lcom/samsung/android/server/wifi/SemWifiIntelligentConnectionManager;-><init>(Landroid/content/Context;Lcom/samsung/android/server/wifi/SemWifiInjector;Landroid/net/wifi/WifiManager;Landroid/os/HandlerThread;Lcom/samsung/android/server/wifi/silentroaming/SemThroughputPredictor;Lcom/samsung/android/server/wifi/silentroaming/SilentRoamingManager;)V
 
@@ -1457,7 +1455,7 @@
 
     new-instance v0, Lcom/samsung/android/server/wifi/SemRoamingAssistant;
 
-    invoke-direct {v0, v4, v8, v2}, Lcom/samsung/android/server/wifi/SemRoamingAssistant;-><init>(Lcom/samsung/android/server/wifi/SemWifiInjector;Lcom/samsung/android/server/wifi/halclient/SemWifiNative;Lcom/samsung/android/server/wifi/util/SemClock;)V
+    invoke-direct {v0, v4, v7, v2}, Lcom/samsung/android/server/wifi/SemRoamingAssistant;-><init>(Lcom/samsung/android/server/wifi/SemWifiInjector;Lcom/samsung/android/server/wifi/halclient/SemWifiNative;Lcom/samsung/android/server/wifi/util/SemClock;)V
 
     iput-object v0, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mSemRoamingAssistant:Lcom/samsung/android/server/wifi/SemRoamingAssistant;
 
@@ -1523,119 +1521,21 @@
 
     invoke-static {v11, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
 
-    new-instance v0, Lcom/samsung/android/server/wifi/SemApeController;
-
-    invoke-static {}, Landroid/os/Looper;->myLooper()Landroid/os/Looper;
-
-    move-result-object v3
-
-    invoke-direct {v0, v1, v3}, Lcom/samsung/android/server/wifi/SemApeController;-><init>(Landroid/content/Context;Landroid/os/Looper;)V
-
-    iput-object v0, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mApeController:Lcom/samsung/android/server/wifi/SemApeController;
-
-    invoke-virtual {v4}, Lcom/samsung/android/server/wifi/SemWifiInjector;->getFrameworkFacade()Lcom/samsung/android/server/wifi/SemFrameworkFacade;
-
-    move-result-object v1
-
-    invoke-virtual {v0, v1}, Lcom/samsung/android/server/wifi/SemApeController;->registerContentObserver(Lcom/samsung/android/server/wifi/SemFrameworkFacade;)V
-
-    iget-object v0, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mApeController:Lcom/samsung/android/server/wifi/SemApeController;
-
-    invoke-virtual {v7, v0}, Lcom/samsung/android/server/wifi/SemWifiOptimizer;->setApeController(Lcom/samsung/android/server/wifi/SemApeController;)V
-
-    new-instance v0, Landroid/os/HandlerThread;
-
-    const-string v1, "SemApeService"
-
-    invoke-direct {v0, v1}, Landroid/os/HandlerThread;-><init>(Ljava/lang/String;)V
-
-    invoke-virtual {v0}, Landroid/os/HandlerThread;->start()V
-
-    const/high16 v1, 0x41700000    # 15.0f
-
-    :try_start_0
-    const-string v3, "17.0"
-
-    invoke-static {v3}, Ljava/lang/Float;->parseFloat(Ljava/lang/String;)F
-
-    move-result v3
-    :try_end_0
-    .catch Ljava/lang/NumberFormatException; {:try_start_0 .. :try_end_0} :catch_0
-
-    goto :goto_4
-
-    :catch_0
-    move v3, v1
-
-    :goto_4
-    new-instance v5, Ljava/lang/StringBuilder;
-
-    const-string v6, "SEP ver="
-
-    invoke-direct {v5, v6}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
-
-    invoke-virtual {v5, v3}, Ljava/lang/StringBuilder;->append(F)Ljava/lang/StringBuilder;
-
-    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
-
-    move-result-object v5
-
-    invoke-static {v11, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
-
-    cmpl-float v1, v3, v1
-
-    if-lez v1, :cond_5
-
-    new-instance v1, Lcom/samsung/android/server/wifi/SemApeServiceImplV2;
-
-    iget-object v3, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mContext:Landroid/content/Context;
-
-    iget-object v5, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mClientModeManager:Lcom/samsung/android/server/wifi/SemClientModeManager;
-
-    invoke-direct {v1, v3, v0, v5}, Lcom/samsung/android/server/wifi/SemApeServiceImplV2;-><init>(Landroid/content/Context;Landroid/os/HandlerThread;Lcom/samsung/android/server/wifi/SemClientModeManager;)V
-
-    iget-object v0, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiCtlFeatureMediator:Lcom/samsung/android/server/wifi/SemWifiCtlFeatureMediator;
-
-    if-eqz v0, :cond_4
-
-    invoke-virtual {v1, v0}, Lcom/samsung/android/server/wifi/SemApeServiceImplV2;->setMediator(Lcom/samsung/android/server/wifi/SemWifiCtlFeatureMediator;)V
-
-    :cond_4
-    iput-object v1, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mApeService:Lcom/samsung/android/server/wifi/SemApeService;
-
-    goto :goto_5
-
-    :cond_5
-    new-instance v1, Lcom/samsung/android/server/wifi/SemApeServiceImplV1;
-
-    iget-object v3, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mContext:Landroid/content/Context;
-
-    iget-object v5, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mClientModeManager:Lcom/samsung/android/server/wifi/SemClientModeManager;
-
-    invoke-direct {v1, v3, v0, v5}, Lcom/samsung/android/server/wifi/SemApeServiceImplV1;-><init>(Landroid/content/Context;Landroid/os/HandlerThread;Lcom/samsung/android/server/wifi/SemClientModeManager;)V
-
-    iput-object v1, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mApeService:Lcom/samsung/android/server/wifi/SemApeService;
-
-    :goto_5
     new-instance v0, Lcom/samsung/android/server/wifi/SemQboxController;
 
-    iget-object v1, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mContext:Landroid/content/Context;
-
     invoke-static {}, Landroid/os/Looper;->myLooper()Landroid/os/Looper;
 
     move-result-object v3
 
-    iget-object v5, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mClientModeManager:Lcom/samsung/android/server/wifi/SemClientModeManager;
-
-    invoke-direct {v0, v1, v3, v5}, Lcom/samsung/android/server/wifi/SemQboxController;-><init>(Landroid/content/Context;Landroid/os/Looper;Lcom/samsung/android/server/wifi/SemClientModeManager;)V
+    invoke-direct {v0, v1, v3, v12}, Lcom/samsung/android/server/wifi/SemQboxController;-><init>(Landroid/content/Context;Landroid/os/Looper;Lcom/samsung/android/server/wifi/SemClientModeManager;)V
 
     iput-object v0, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mQboxController:Lcom/samsung/android/server/wifi/SemQboxController;
 
     invoke-virtual {v4}, Lcom/samsung/android/server/wifi/SemWifiInjector;->getFrameworkFacade()Lcom/samsung/android/server/wifi/SemFrameworkFacade;
 
-    move-result-object v1
+    move-result-object v3
 
-    invoke-virtual {v0, v1}, Lcom/samsung/android/server/wifi/SemQboxController;->registerContentObserver(Lcom/samsung/android/server/wifi/SemFrameworkFacade;)V
+    invoke-virtual {v0, v3}, Lcom/samsung/android/server/wifi/SemQboxController;->registerContentObserver(Lcom/samsung/android/server/wifi/SemFrameworkFacade;)V
 
     const-string v0, "1"
 
@@ -1643,7 +1543,7 @@
 
     move-result v0
 
-    if-lez v0, :cond_6
+    if-lez v0, :cond_4
 
     const-string v0, "SemL4sController start"
 
@@ -1651,70 +1551,54 @@
 
     new-instance v0, Lcom/samsung/android/server/wifi/SemL4sController;
 
-    iget-object v1, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mContext:Landroid/content/Context;
-
     invoke-static {}, Landroid/os/Looper;->myLooper()Landroid/os/Looper;
 
     move-result-object v3
 
-    iget-object v5, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mClientModeManager:Lcom/samsung/android/server/wifi/SemClientModeManager;
-
-    invoke-direct {v0, v1, v3, v5}, Lcom/samsung/android/server/wifi/SemL4sController;-><init>(Landroid/content/Context;Landroid/os/Looper;Lcom/samsung/android/server/wifi/SemClientModeManager;)V
+    invoke-direct {v0, v1, v3, v12}, Lcom/samsung/android/server/wifi/SemL4sController;-><init>(Landroid/content/Context;Landroid/os/Looper;Lcom/samsung/android/server/wifi/SemClientModeManager;)V
 
     iput-object v0, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mL4sController:Lcom/samsung/android/server/wifi/SemL4sController;
 
     invoke-virtual {v4}, Lcom/samsung/android/server/wifi/SemWifiInjector;->getFrameworkFacade()Lcom/samsung/android/server/wifi/SemFrameworkFacade;
 
-    move-result-object v1
+    move-result-object v3
 
-    invoke-virtual {v0, v1}, Lcom/samsung/android/server/wifi/SemL4sController;->registerContentObserver(Lcom/samsung/android/server/wifi/SemFrameworkFacade;)V
+    invoke-virtual {v0, v3}, Lcom/samsung/android/server/wifi/SemL4sController;->registerContentObserver(Lcom/samsung/android/server/wifi/SemFrameworkFacade;)V
 
-    :cond_6
-    iget-object v0, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mFrameworkFacade:Lcom/samsung/android/server/wifi/SemFrameworkFacade;
-
-    invoke-virtual {v0}, Lcom/samsung/android/server/wifi/SemFrameworkFacade;->isFactoryBinary()Z
+    :cond_4
+    invoke-virtual {v5}, Lcom/samsung/android/server/wifi/SemFrameworkFacade;->isFactoryBinary()Z
 
     move-result v0
 
-    if-nez v0, :cond_7
+    const-string v3, "0"
 
-    const-string v0, "0"
+    if-nez v0, :cond_5
 
-    invoke-static {v0}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I
+    invoke-static {v3}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I
 
     move-result v0
 
-    if-lez v0, :cond_7
+    if-lez v0, :cond_5
 
     new-instance v0, Lcom/samsung/android/server/wifi/SemWifiResourceManager;
 
-    iget-object v1, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mContext:Landroid/content/Context;
-
-    iget-object v2, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiNative:Lcom/samsung/android/server/wifi/halclient/SemWifiNative;
-
-    invoke-direct {v0, v1, v2, v4}, Lcom/samsung/android/server/wifi/SemWifiResourceManager;-><init>(Landroid/content/Context;Lcom/samsung/android/server/wifi/halclient/SemWifiNative;Lcom/samsung/android/server/wifi/SemWifiInjector;)V
+    invoke-direct {v0, v1, v7, v4}, Lcom/samsung/android/server/wifi/SemWifiResourceManager;-><init>(Landroid/content/Context;Lcom/samsung/android/server/wifi/halclient/SemWifiNative;Lcom/samsung/android/server/wifi/SemWifiInjector;)V
 
     iput-object v0, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiResourceManager:Lcom/samsung/android/server/wifi/SemWifiResourceManager;
 
-    iget-object v1, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiBackOffController:Lcom/samsung/android/server/wifi/backoff/WifiBackOffController;
+    move-object/from16 v2, v24
 
-    invoke-virtual {v1, v0}, Lcom/samsung/android/server/wifi/backoff/WifiBackOffController;->setDbsProvider(Lcom/samsung/android/server/wifi/DbsModeProvider;)V
+    invoke-virtual {v2, v0}, Lcom/samsung/android/server/wifi/backoff/WifiBackOffController;->setDbsProvider(Lcom/samsung/android/server/wifi/DbsModeProvider;)V
 
-    goto :goto_6
+    goto :goto_4
 
-    :cond_7
+    :cond_5
     iput-object v2, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiResourceManager:Lcom/samsung/android/server/wifi/SemWifiResourceManager;
 
-    :goto_6
+    :goto_4
     new-instance v0, Lcom/samsung/android/server/wifi/SemWifiCoexManager;
 
-    iget-object v1, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mContext:Landroid/content/Context;
-
-    iget-object v2, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiManagerProxy:Lcom/samsung/android/server/wifi/SemWifiManagerProxy;
-
-    iget-object v3, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiNative:Lcom/samsung/android/server/wifi/halclient/SemWifiNative;
-
-    invoke-direct {v0, v1, v2, v3, v4}, Lcom/samsung/android/server/wifi/SemWifiCoexManager;-><init>(Landroid/content/Context;Lcom/samsung/android/server/wifi/SemWifiManagerProxy;Lcom/samsung/android/server/wifi/halclient/SemWifiNative;Lcom/samsung/android/server/wifi/SemWifiInjector;)V
+    invoke-direct {v0, v1, v15, v7, v4}, Lcom/samsung/android/server/wifi/SemWifiCoexManager;-><init>(Landroid/content/Context;Lcom/samsung/android/server/wifi/SemWifiManagerProxy;Lcom/samsung/android/server/wifi/halclient/SemWifiNative;Lcom/samsung/android/server/wifi/SemWifiInjector;)V
 
     iput-object v0, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiCoexManager:Lcom/samsung/android/server/wifi/SemWifiCoexManager;
 
@@ -1724,30 +1608,26 @@
 
     move-result v0
 
-    if-lez v0, :cond_8
-
-    const-string v1, "Conn.Personalizer"
-
-    invoke-static {v1}, Lcom/samsung/android/server/wifi/SemPreScanResultProcessor$$ExternalSyntheticOutline0;->m(Ljava/lang/String;)Landroid/os/HandlerThread;
+    if-lez v0, :cond_6
 
-    move-result-object v1
+    const-string v2, "Conn.Personalizer"
 
-    new-instance v2, Lcom/samsung/android/server/wifi/connection/ConnectionPersonalizer;
+    invoke-static {v2}, Lcom/samsung/android/server/wifi/SemPreScanResultProcessor$$ExternalSyntheticOutline0;->m(Ljava/lang/String;)Landroid/os/HandlerThread;
 
-    iget-object v3, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mContext:Landroid/content/Context;
+    move-result-object v2
 
-    invoke-direct {v2, v3, v4, v1, v0}, Lcom/samsung/android/server/wifi/connection/ConnectionPersonalizer;-><init>(Landroid/content/Context;Lcom/samsung/android/server/wifi/SemWifiInjector;Landroid/os/HandlerThread;I)V
+    new-instance v3, Lcom/samsung/android/server/wifi/connection/ConnectionPersonalizer;
 
-    iput-object v2, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mConnectionPersonalizer:Lcom/samsung/android/server/wifi/connection/ConnectionPersonalizer;
+    invoke-direct {v3, v1, v4, v2, v0}, Lcom/samsung/android/server/wifi/connection/ConnectionPersonalizer;-><init>(Landroid/content/Context;Lcom/samsung/android/server/wifi/SemWifiInjector;Landroid/os/HandlerThread;I)V
 
-    iget-object v0, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mClientModeManager:Lcom/samsung/android/server/wifi/SemClientModeManager;
+    iput-object v3, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mConnectionPersonalizer:Lcom/samsung/android/server/wifi/connection/ConnectionPersonalizer;
 
-    invoke-virtual {v0, v2}, Lcom/samsung/android/server/wifi/SemClientModeManager;->registerClientModeStateListener(Lcom/samsung/android/server/wifi/ClientModeStateListener;)V
+    invoke-virtual {v12, v3}, Lcom/samsung/android/server/wifi/SemClientModeManager;->registerClientModeStateListener(Lcom/samsung/android/server/wifi/ClientModeStateListener;)V
 
-    :cond_8
+    :cond_6
     return-void
 
-    :cond_9
+    :cond_7
     new-instance v0, Ljava/lang/IllegalStateException;
 
     const-string v1, "SemWifiInjector was already created, use getInstance instead."
@@ -1756,7 +1636,7 @@
 
     throw v0
 
-    :cond_a
+    :cond_8
     new-instance v0, Ljava/lang/IllegalStateException;
 
     const-string v1, "SemWifiInjector should not be initialized with a null Context."
diff --git a/smali/com/samsung/android/server/wifi/SemWifiShellCommand$SqeCommandHandler.smali b/smali/com/samsung/android/server/wifi/SemWifiShellCommand$SqeCommandHandler.smali
index 9cded28..2993fa7 100644
--- a/smali/com/samsung/android/server/wifi/SemWifiShellCommand$SqeCommandHandler.smali
+++ b/smali/com/samsung/android/server/wifi/SemWifiShellCommand$SqeCommandHandler.smali
@@ -74,7 +74,7 @@
     return p0
 
     :pswitch_0
-    invoke-virtual {p2, v4}, Ljava/io/PrintWriter;->println(Ljava/lang/String;)V
+    invoke-virtual {p2, v3}, Ljava/io/PrintWriter;->println(Ljava/lang/String;)V
 
     return v5
 
-- 
2.51.0

