From 1d7df8402d00bfb5958c707d22672efae48d8cbb Mon Sep 17 00:00:00 2001
From: Salvo Giangreco <giangrecosalvo9@gmail.com>
Date: Sun, 31 Aug 2025 15:42:41 +0200
Subject: [PATCH] Allow custom CONNECTION_PERSONALIZATION value

UN1CA: this patch is not complete! Please check unica/patches/product_feature/customize.sh for more info.
---
 .../android/server/wifi/SemWifiInjector.smali | 68 ++++++++++---------
 1 file changed, 35 insertions(+), 33 deletions(-)

diff --git a/smali/com/samsung/android/server/wifi/SemWifiInjector.smali b/smali/com/samsung/android/server/wifi/SemWifiInjector.smali
index defc408..eb567f9 100644
--- a/smali/com/samsung/android/server/wifi/SemWifiInjector.smali
+++ b/smali/com/samsung/android/server/wifi/SemWifiInjector.smali
@@ -1641,64 +1641,64 @@
 
     invoke-static {v0}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I
 
-    move-result v1
+    move-result v0
 
-    if-lez v1, :cond_6
+    if-lez v0, :cond_6
 
-    const-string v1, "SemL4sController start"
+    const-string v0, "SemL4sController start"
 
-    invoke-static {v11, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
+    invoke-static {v11, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
 
-    new-instance v1, Lcom/samsung/android/server/wifi/SemL4sController;
+    new-instance v0, Lcom/samsung/android/server/wifi/SemL4sController;
 
-    iget-object v3, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mContext:Landroid/content/Context;
+    iget-object v1, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mContext:Landroid/content/Context;
 
     invoke-static {}, Landroid/os/Looper;->myLooper()Landroid/os/Looper;
 
-    move-result-object v5
+    move-result-object v3
 
-    iget-object v6, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mClientModeManager:Lcom/samsung/android/server/wifi/SemClientModeManager;
+    iget-object v5, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mClientModeManager:Lcom/samsung/android/server/wifi/SemClientModeManager;
 
-    invoke-direct {v1, v3, v5, v6}, Lcom/samsung/android/server/wifi/SemL4sController;-><init>(Landroid/content/Context;Landroid/os/Looper;Lcom/samsung/android/server/wifi/SemClientModeManager;)V
+    invoke-direct {v0, v1, v3, v5}, Lcom/samsung/android/server/wifi/SemL4sController;-><init>(Landroid/content/Context;Landroid/os/Looper;Lcom/samsung/android/server/wifi/SemClientModeManager;)V
 
-    iput-object v1, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mL4sController:Lcom/samsung/android/server/wifi/SemL4sController;
+    iput-object v0, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mL4sController:Lcom/samsung/android/server/wifi/SemL4sController;
 
     invoke-virtual {v4}, Lcom/samsung/android/server/wifi/SemWifiInjector;->getFrameworkFacade()Lcom/samsung/android/server/wifi/SemFrameworkFacade;
 
-    move-result-object v3
+    move-result-object v1
 
-    invoke-virtual {v1, v3}, Lcom/samsung/android/server/wifi/SemL4sController;->registerContentObserver(Lcom/samsung/android/server/wifi/SemFrameworkFacade;)V
+    invoke-virtual {v0, v1}, Lcom/samsung/android/server/wifi/SemL4sController;->registerContentObserver(Lcom/samsung/android/server/wifi/SemFrameworkFacade;)V
 
     :cond_6
-    iget-object v1, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mFrameworkFacade:Lcom/samsung/android/server/wifi/SemFrameworkFacade;
+    iget-object v0, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mFrameworkFacade:Lcom/samsung/android/server/wifi/SemFrameworkFacade;
 
-    invoke-virtual {v1}, Lcom/samsung/android/server/wifi/SemFrameworkFacade;->isFactoryBinary()Z
+    invoke-virtual {v0}, Lcom/samsung/android/server/wifi/SemFrameworkFacade;->isFactoryBinary()Z
 
-    move-result v1
+    move-result v0
 
-    if-nez v1, :cond_7
+    if-nez v0, :cond_7
 
-    const-string v1, "0"
+    const-string v0, "0"
 
-    invoke-static {v1}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I
+    invoke-static {v0}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I
 
-    move-result v1
+    move-result v0
 
-    if-lez v1, :cond_7
+    if-lez v0, :cond_7
 
-    new-instance v1, Lcom/samsung/android/server/wifi/SemWifiResourceManager;
+    new-instance v0, Lcom/samsung/android/server/wifi/SemWifiResourceManager;
 
-    iget-object v2, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mContext:Landroid/content/Context;
+    iget-object v1, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mContext:Landroid/content/Context;
 
-    iget-object v3, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiNative:Lcom/samsung/android/server/wifi/halclient/SemWifiNative;
+    iget-object v2, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiNative:Lcom/samsung/android/server/wifi/halclient/SemWifiNative;
 
-    invoke-direct {v1, v2, v3, v4}, Lcom/samsung/android/server/wifi/SemWifiResourceManager;-><init>(Landroid/content/Context;Lcom/samsung/android/server/wifi/halclient/SemWifiNative;Lcom/samsung/android/server/wifi/SemWifiInjector;)V
+    invoke-direct {v0, v1, v2, v4}, Lcom/samsung/android/server/wifi/SemWifiResourceManager;-><init>(Landroid/content/Context;Lcom/samsung/android/server/wifi/halclient/SemWifiNative;Lcom/samsung/android/server/wifi/SemWifiInjector;)V
 
-    iput-object v1, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiResourceManager:Lcom/samsung/android/server/wifi/SemWifiResourceManager;
+    iput-object v0, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiResourceManager:Lcom/samsung/android/server/wifi/SemWifiResourceManager;
 
-    iget-object v2, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiBackOffController:Lcom/samsung/android/server/wifi/backoff/WifiBackOffController;
+    iget-object v1, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiBackOffController:Lcom/samsung/android/server/wifi/backoff/WifiBackOffController;
 
-    invoke-virtual {v2, v1}, Lcom/samsung/android/server/wifi/backoff/WifiBackOffController;->setDbsProvider(Lcom/samsung/android/server/wifi/DbsModeProvider;)V
+    invoke-virtual {v1, v0}, Lcom/samsung/android/server/wifi/backoff/WifiBackOffController;->setDbsProvider(Lcom/samsung/android/server/wifi/DbsModeProvider;)V
 
     goto :goto_6
 
@@ -1706,17 +1706,19 @@
     iput-object v2, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiResourceManager:Lcom/samsung/android/server/wifi/SemWifiResourceManager;
 
     :goto_6
-    new-instance v1, Lcom/samsung/android/server/wifi/SemWifiCoexManager;
+    new-instance v0, Lcom/samsung/android/server/wifi/SemWifiCoexManager;
 
-    iget-object v2, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mContext:Landroid/content/Context;
+    iget-object v1, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mContext:Landroid/content/Context;
 
-    iget-object v3, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiManagerProxy:Lcom/samsung/android/server/wifi/SemWifiManagerProxy;
+    iget-object v2, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiManagerProxy:Lcom/samsung/android/server/wifi/SemWifiManagerProxy;
+
+    iget-object v3, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiNative:Lcom/samsung/android/server/wifi/halclient/SemWifiNative;
 
-    iget-object v5, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiNative:Lcom/samsung/android/server/wifi/halclient/SemWifiNative;
+    invoke-direct {v0, v1, v2, v3, v4}, Lcom/samsung/android/server/wifi/SemWifiCoexManager;-><init>(Landroid/content/Context;Lcom/samsung/android/server/wifi/SemWifiManagerProxy;Lcom/samsung/android/server/wifi/halclient/SemWifiNative;Lcom/samsung/android/server/wifi/SemWifiInjector;)V
 
-    invoke-direct {v1, v2, v3, v5, v4}, Lcom/samsung/android/server/wifi/SemWifiCoexManager;-><init>(Landroid/content/Context;Lcom/samsung/android/server/wifi/SemWifiManagerProxy;Lcom/samsung/android/server/wifi/halclient/SemWifiNative;Lcom/samsung/android/server/wifi/SemWifiInjector;)V
+    iput-object v0, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiCoexManager:Lcom/samsung/android/server/wifi/SemWifiCoexManager;
 
-    iput-object v1, v4, Lcom/samsung/android/server/wifi/SemWifiInjector;->mWifiCoexManager:Lcom/samsung/android/server/wifi/SemWifiCoexManager;
+    const-string v0, "CONFIG_CONNECTION_PERSONALIZATION"
 
     invoke-static {v0}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I
 
-- 
2.51.0

