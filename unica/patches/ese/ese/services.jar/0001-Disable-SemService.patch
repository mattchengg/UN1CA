From 0e5624bb2c7e577c26ee5ba271d03501d890a89b Mon Sep 17 00:00:00 2001
From: Salvo Giangreco <giangrecosalvo9@gmail.com>
Date: Mon, 10 Nov 2025 13:00:11 +0100
Subject: [PATCH] Disable SemService

---
 smali/com/android/server/SystemConfig.smali   |  87 +++++++--------
 ...temServer$$ExternalSyntheticLambda10.smali | 105 +++++++-----------
 .../ucmservice/CredentialManagerService.smali |   4 +-
 3 files changed, 85 insertions(+), 111 deletions(-)

diff --git a/smali/com/android/server/SystemConfig.smali b/smali/com/android/server/SystemConfig.smali
index 31146d0d9..dd7f28129 100644
--- a/smali/com/android/server/SystemConfig.smali
+++ b/smali/com/android/server/SystemConfig.smali
@@ -2646,7 +2646,7 @@
 
     invoke-static {v2, v8}, Landroid/util/Slog;->d(Ljava/lang/String;Ljava/lang/String;)I
 
-    const-string/jumbo v8, "eSE_COS: JCOP6.2U"
+    const-string/jumbo v8, "eSE_COS: "
 
     invoke-static {v2, v8}, Landroid/util/Slog;->d(Ljava/lang/String;Ljava/lang/String;)I
 
@@ -2666,14 +2666,13 @@
 
     move-result v0
 
-    if-eqz v0, :cond_16
+    if-eqz v0, :cond_15
 
-    :cond_15
     move v0, v6
 
     goto :goto_10
 
-    :cond_16
+    :cond_15
     move v0, v9
 
     :goto_10
@@ -2687,7 +2686,7 @@
 
     check-cast v8, Landroid/content/pm/FeatureInfo;
 
-    if-eqz v8, :cond_17
+    if-eqz v8, :cond_16
 
     const-string/jumbo v8, "support GP Felica"
 
@@ -2697,7 +2696,7 @@
 
     goto :goto_11
 
-    :cond_17
+    :cond_16
     move v8, v9
 
     :goto_11
@@ -2707,7 +2706,7 @@
 
     move-result v10
 
-    if-nez v10, :cond_19
+    if-nez v10, :cond_18
 
     const-string v10, "JP"
 
@@ -2715,16 +2714,16 @@
 
     move-result v10
 
-    if-eqz v10, :cond_18
+    if-eqz v10, :cond_17
 
     goto :goto_12
 
-    :cond_18
+    :cond_17
     move v10, v9
 
     goto :goto_13
 
-    :cond_19
+    :cond_18
     :goto_12
     move v10, v6
 
@@ -2757,19 +2756,19 @@
 
     invoke-static {v2, v5}, Landroid/util/Slog;->d(Ljava/lang/String;Ljava/lang/String;)I
 
-    if-eqz v0, :cond_1a
+    if-eqz v0, :cond_19
 
-    if-eqz v10, :cond_1b
+    if-eqz v10, :cond_1a
 
-    :cond_1a
-    if-eqz v8, :cond_1c
+    :cond_19
+    if-eqz v8, :cond_1b
 
-    :cond_1b
+    :cond_1a
     move v13, v6
 
     goto :goto_14
 
-    :cond_1c
+    :cond_1b
     move v13, v9
 
     :goto_14
@@ -2779,7 +2778,7 @@
 
     const-string/jumbo v0, "android.hardware.se.omapi.ese"
 
-    if-eqz v13, :cond_1d
+    if-eqz v13, :cond_1c
 
     invoke-virtual {v1, v9, v0}, Lcom/android/server/SystemConfig;->addFeature(ILjava/lang/String;)V
 
@@ -2789,7 +2788,7 @@
 
     goto :goto_15
 
-    :cond_1d
+    :cond_1c
     invoke-virtual {v1, v0}, Lcom/android/server/SystemConfig;->removeFeature(Ljava/lang/String;)V
 
     const-string/jumbo v0, "removed eSE secure element feature: not support se"
@@ -2803,7 +2802,7 @@
 
     const/16 v2, 0x3e8
 
-    if-ne v0, v2, :cond_20
+    if-ne v0, v2, :cond_1f
 
     invoke-static {}, Landroid/os/Environment;->getApexDirectory()Ljava/io/File;
 
@@ -2818,7 +2817,7 @@
     move v5, v9
 
     :goto_16
-    if-ge v5, v2, :cond_20
+    if-ge v5, v2, :cond_1f
 
     aget-object v6, v0, v5
 
@@ -2826,7 +2825,7 @@
 
     move-result v8
 
-    if-nez v8, :cond_1f
+    if-nez v8, :cond_1e
 
     invoke-virtual {v6}, Ljava/io/File;->getPath()Ljava/lang/String;
 
@@ -2838,11 +2837,11 @@
 
     move-result v8
 
-    if-eqz v8, :cond_1e
+    if-eqz v8, :cond_1d
 
     goto :goto_17
 
-    :cond_1e
+    :cond_1d
     filled-new-array {v4, v7}, [Ljava/lang/String;
 
     move-result-object v8
@@ -2855,18 +2854,18 @@
 
     invoke-virtual {v1, v3, v6, v8}, Lcom/android/server/SystemConfig;->readPermissions(Lorg/xmlpull/v1/XmlPullParser;Ljava/io/File;I)V
 
-    :cond_1f
+    :cond_1e
     :goto_17
     add-int/lit8 v5, v5, 0x1
 
     goto :goto_16
 
-    :cond_20
+    :cond_1f
     invoke-static {}, Landroid/os/storage/StorageManager;->isFileEncrypted()Z
 
     move-result v0
 
-    if-eqz v0, :cond_21
+    if-eqz v0, :cond_20
 
     const-string/jumbo v0, "android.software.file_based_encryption"
 
@@ -2876,23 +2875,23 @@
 
     invoke-virtual {v1, v9, v0}, Lcom/android/server/SystemConfig;->addFeature(ILjava/lang/String;)V
 
-    :cond_21
+    :cond_20
     invoke-static {}, Landroid/os/storage/StorageManager;->hasAdoptable()Z
 
     move-result v0
 
-    if-eqz v0, :cond_22
+    if-eqz v0, :cond_21
 
     const-string/jumbo v0, "android.software.adoptable_storage"
 
     invoke-virtual {v1, v9, v0}, Lcom/android/server/SystemConfig;->addFeature(ILjava/lang/String;)V
 
-    :cond_22
+    :cond_21
     invoke-static {}, Landroid/app/ActivityManager;->isLowRamDeviceStatic()Z
 
     move-result v0
 
-    if-eqz v0, :cond_23
+    if-eqz v0, :cond_22
 
     const-string/jumbo v0, "android.hardware.ram.low"
 
@@ -2900,7 +2899,7 @@
 
     goto :goto_18
 
-    :cond_23
+    :cond_22
     const-string/jumbo v0, "android.hardware.ram.normal"
 
     invoke-virtual {v1, v9, v0}, Lcom/android/server/SystemConfig;->addFeature(ILjava/lang/String;)V
@@ -2914,13 +2913,13 @@
 
     move-result v0
 
-    if-lez v0, :cond_24
+    if-lez v0, :cond_23
 
     const-string/jumbo v2, "android.software.incremental_delivery"
 
     invoke-virtual {v1, v0, v2}, Lcom/android/server/SystemConfig;->addFeature(ILjava/lang/String;)V
 
-    :cond_24
+    :cond_23
     const-string/jumbo v0, "android.software.app_enumeration"
 
     invoke-virtual {v1, v9, v0}, Lcom/android/server/SystemConfig;->addFeature(ILjava/lang/String;)V
@@ -2929,13 +2928,13 @@
 
     const/16 v2, 0x1d
 
-    if-lt v0, v2, :cond_25
+    if-lt v0, v2, :cond_24
 
     const-string/jumbo v2, "android.software.ipsec_tunnels"
 
     invoke-virtual {v1, v9, v2}, Lcom/android/server/SystemConfig;->addFeature(ILjava/lang/String;)V
 
-    :cond_25
+    :cond_24
     const-string/jumbo v2, "ro.vendor.api_level"
 
     invoke-static {v2, v0}, Landroid/os/SystemProperties;->getInt(Ljava/lang/String;I)I
@@ -2944,13 +2943,13 @@
 
     const/16 v2, 0x21
 
-    if-le v0, v2, :cond_26
+    if-le v0, v2, :cond_25
 
     const-string/jumbo v0, "android.software.ipsec_tunnel_migration"
 
     invoke-virtual {v1, v9, v0}, Lcom/android/server/SystemConfig;->addFeature(ILjava/lang/String;)V
 
-    :cond_26
+    :cond_25
     :try_start_7
     const-string v0, "/sys/fs/erofs"
 
@@ -2974,7 +2973,7 @@
     move v0, v9
 
     :goto_19
-    if-eqz v0, :cond_28
+    if-eqz v0, :cond_27
 
     const/4 v0, 0x5
 
@@ -2984,7 +2983,7 @@
 
     move-result v0
 
-    if-eqz v0, :cond_27
+    if-eqz v0, :cond_26
 
     const-string/jumbo v0, "android.software.erofs"
 
@@ -2992,7 +2991,7 @@
 
     goto :goto_1a
 
-    :cond_27
+    :cond_26
     const/4 v0, 0x4
 
     const/16 v2, 0x13
@@ -3001,13 +3000,13 @@
 
     move-result v0
 
-    if-eqz v0, :cond_28
+    if-eqz v0, :cond_27
 
     const-string/jumbo v0, "android.software.erofs_legacy"
 
     invoke-virtual {v1, v9, v0}, Lcom/android/server/SystemConfig;->addFeature(ILjava/lang/String;)V
 
-    :cond_28
+    :cond_27
     :goto_1a
     iget-object v0, v1, Lcom/android/server/SystemConfig;->mUnavailableFeatures:Landroid/util/ArraySet;
 
@@ -3020,7 +3019,7 @@
 
     move-result v2
 
-    if-eqz v2, :cond_29
+    if-eqz v2, :cond_28
 
     invoke-interface {v0}, Ljava/util/Iterator;->next()Ljava/lang/Object;
 
@@ -3032,7 +3031,7 @@
 
     goto :goto_1b
 
-    :cond_29
+    :cond_28
     return-void
 .end method
 
diff --git a/smali/com/android/server/SystemServer$$ExternalSyntheticLambda10.smali b/smali/com/android/server/SystemServer$$ExternalSyntheticLambda10.smali
index 142f2430b..eddd6258b 100644
--- a/smali/com/android/server/SystemServer$$ExternalSyntheticLambda10.smali
+++ b/smali/com/android/server/SystemServer$$ExternalSyntheticLambda10.smali
@@ -46,34 +46,11 @@
 
     move-result-object v2
 
-    const-string/jumbo v3, "SemService"
-
-    invoke-virtual {v2, v3}, Lcom/android/server/utils/TimingsTraceAndSlog;->traceBegin(Ljava/lang/String;)V
-
-    :try_start_0
-    const-class v4, Lcom/android/server/SemService;
-
-    invoke-static {v3, v4}, Landroid/os/ServiceManager;->addService(Ljava/lang/String;Ljava/lang/Class;)V
-    :try_end_0
-    .catchall {:try_start_0 .. :try_end_0} :catchall_0
-
-    goto :goto_0
-
-    :catchall_0
-    move-exception v3
-
-    const-string v4, "Failure starting SemService"
-
-    invoke-static {v4, v3}, Lcom/android/server/SystemServer;->reportWtf(Ljava/lang/String;Ljava/lang/Throwable;)V
-
-    :goto_0
-    invoke-virtual {v2}, Landroid/util/TimingsTraceLog;->traceEnd()V
-
     const-string v3, "Blockchain Service"
 
     invoke-virtual {v2, v3}, Lcom/android/server/utils/TimingsTraceAndSlog;->traceBegin(Ljava/lang/String;)V
 
-    :try_start_1
+    :try_start_0
     invoke-static {v1, v3}, Landroid/util/Slog;->i(Ljava/lang/String;Ljava/lang/String;)I
 
     const-string/jumbo v3, "blockchain"
@@ -85,26 +62,26 @@
     invoke-direct {v4, v5}, Lcom/android/server/SystemServer$5;-><init>(I)V
 
     invoke-static {v3, v4}, Landroid/os/ServiceManager;->addService(Ljava/lang/String;Landroid/os/IServiceCreator;)V
-    :try_end_1
-    .catchall {:try_start_1 .. :try_end_1} :catchall_1
+    :try_end_0
+    .catchall {:try_start_0 .. :try_end_0} :catchall_0
 
-    goto :goto_1
+    goto :goto_0
 
-    :catchall_1
+    :catchall_0
     move-exception v3
 
     const-string v4, "Failure starting Blockchain TZ Service"
 
     invoke-static {v1, v4, v3}, Landroid/util/Slog;->e(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)I
 
-    :goto_1
+    :goto_0
     invoke-virtual {v2}, Landroid/util/TimingsTraceLog;->traceEnd()V
 
     const-string/jumbo v3, "SemAuthnrService"
 
     invoke-virtual {v2, v3}, Lcom/android/server/utils/TimingsTraceAndSlog;->traceBegin(Ljava/lang/String;)V
 
-    :try_start_2
+    :try_start_1
     new-instance v4, Lcom/android/server/SystemServer$5;
 
     const/4 v5, 0x6
@@ -112,42 +89,42 @@
     invoke-direct {v4, v5}, Lcom/android/server/SystemServer$5;-><init>(I)V
 
     invoke-static {v3, v4}, Landroid/os/ServiceManager;->addService(Ljava/lang/String;Landroid/os/IServiceCreator;)V
-    :try_end_2
-    .catchall {:try_start_2 .. :try_end_2} :catchall_2
+    :try_end_1
+    .catchall {:try_start_1 .. :try_end_1} :catchall_1
 
-    goto :goto_2
+    goto :goto_1
 
-    :catchall_2
+    :catchall_1
     const-string v3, "Failed to add SemAuthnrService."
 
     invoke-static {v1, v3}, Landroid/util/Slog;->e(Ljava/lang/String;Ljava/lang/String;)I
 
-    :goto_2
+    :goto_1
     invoke-virtual {v2}, Landroid/util/TimingsTraceLog;->traceEnd()V
 
     const-string/jumbo v3, "VideoTranscodingService"
 
     invoke-virtual {v2, v3}, Lcom/android/server/utils/TimingsTraceAndSlog;->traceBegin(Ljava/lang/String;)V
 
-    :try_start_3
+    :try_start_2
     const-string/jumbo v3, "SemVideoTranscodingService"
 
     const-class v4, Lcom/samsung/android/media/codec/VideoTranscodingService;
 
     invoke-static {v3, v4}, Landroid/os/ServiceManager;->addService(Ljava/lang/String;Ljava/lang/Class;)V
-    :try_end_3
-    .catchall {:try_start_3 .. :try_end_3} :catchall_3
+    :try_end_2
+    .catchall {:try_start_2 .. :try_end_2} :catchall_2
 
-    goto :goto_3
+    goto :goto_2
 
-    :catchall_3
+    :catchall_2
     move-exception v3
 
     const-string v4, "Failed to start VideoTranscodingService "
 
     invoke-static {v1, v4, v3}, Landroid/util/Slog;->e(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)I
 
-    :goto_3
+    :goto_2
     invoke-virtual {v2}, Landroid/util/TimingsTraceLog;->traceEnd()V
 
     const/4 v3, 0x0
@@ -160,23 +137,23 @@
 
     invoke-virtual {v2, p0}, Lcom/android/server/utils/TimingsTraceAndSlog;->traceBegin(Ljava/lang/String;)V
 
-    :try_start_4
+    :try_start_3
     const-string/jumbo v3, "dsms"
 
     const-class v4, Lcom/samsung/android/jdsms/DsmsService;
 
     invoke-static {v3, v4}, Landroid/os/ServiceManager;->addService(Ljava/lang/String;Ljava/lang/Class;)V
-    :try_end_4
-    .catchall {:try_start_4 .. :try_end_4} :catchall_4
+    :try_end_3
+    .catchall {:try_start_3 .. :try_end_3} :catchall_3
 
-    goto :goto_4
+    goto :goto_3
 
-    :catchall_4
+    :catchall_3
     move-exception v3
 
     invoke-static {p0, v3}, Lcom/android/server/SystemServer;->reportWtf(Ljava/lang/String;Ljava/lang/Throwable;)V
 
-    :goto_4
+    :goto_3
     invoke-virtual {v2}, Landroid/util/TimingsTraceLog;->traceEnd()V
 
     :cond_0
@@ -184,7 +161,7 @@
 
     invoke-virtual {v2, p0}, Lcom/android/server/utils/TimingsTraceAndSlog;->traceBegin(Ljava/lang/String;)V
 
-    :try_start_5
+    :try_start_4
     const-string/jumbo p0, "mpos_service"
 
     new-instance v3, Lcom/android/server/SystemServer$5;
@@ -192,10 +169,10 @@
     invoke-direct {v3, v0}, Lcom/android/server/SystemServer$5;-><init>(I)V
 
     invoke-static {p0, v3}, Landroid/os/ServiceManager;->addService(Ljava/lang/String;Landroid/os/IServiceCreator;)V
-    :try_end_5
-    .catch Ljava/lang/Exception; {:try_start_5 .. :try_end_5} :catch_0
+    :try_end_4
+    .catch Ljava/lang/Exception; {:try_start_4 .. :try_end_4} :catch_0
 
-    goto :goto_5
+    goto :goto_4
 
     :catch_0
     move-exception p0
@@ -206,14 +183,14 @@
 
     invoke-virtual {p0}, Ljava/lang/Exception;->printStackTrace()V
 
-    :goto_5
+    :goto_4
     invoke-virtual {v2}, Landroid/util/TimingsTraceLog;->traceEnd()V
 
     const-string p0, "Email Keystore Service"
 
     invoke-virtual {v2, p0}, Lcom/android/server/utils/TimingsTraceAndSlog;->traceBegin(Ljava/lang/String;)V
 
-    :try_start_6
+    :try_start_5
     invoke-static {v1, p0}, Landroid/util/Slog;->i(Ljava/lang/String;Ljava/lang/String;)I
 
     const-string/jumbo p0, "emailksproxy"
@@ -225,26 +202,26 @@
     invoke-direct {v0, v3}, Lcom/android/server/SystemServer$5;-><init>(I)V
 
     invoke-static {p0, v0}, Landroid/os/ServiceManager;->addService(Ljava/lang/String;Landroid/os/IServiceCreator;)V
-    :try_end_6
-    .catchall {:try_start_6 .. :try_end_6} :catchall_5
+    :try_end_5
+    .catchall {:try_start_5 .. :try_end_5} :catchall_4
 
-    goto :goto_6
+    goto :goto_5
 
-    :catchall_5
+    :catchall_4
     move-exception p0
 
     const-string v0, "Failure starting Email Keystore Service"
 
     invoke-static {v1, v0, p0}, Landroid/util/Slog;->e(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)I
 
-    :goto_6
+    :goto_5
     invoke-virtual {v2}, Landroid/util/TimingsTraceLog;->traceEnd()V
 
     const-string/jumbo p0, "SemSsdidManagerService"
 
     invoke-virtual {v2, p0}, Lcom/android/server/utils/TimingsTraceAndSlog;->traceBegin(Ljava/lang/String;)V
 
-    :try_start_7
+    :try_start_6
     const-string/jumbo p0, "sem_ssdid"
 
     new-instance v0, Lcom/android/server/SystemServer$$ExternalSyntheticLambda11;
@@ -252,19 +229,19 @@
     invoke-direct {v0}, Ljava/lang/Object;-><init>()V
 
     invoke-static {p0, v0}, Landroid/os/ServiceManager;->addService(Ljava/lang/String;Landroid/os/IServiceCreator;)V
-    :try_end_7
-    .catchall {:try_start_7 .. :try_end_7} :catchall_6
+    :try_end_6
+    .catchall {:try_start_6 .. :try_end_6} :catchall_5
 
-    goto :goto_7
+    goto :goto_6
 
-    :catchall_6
+    :catchall_5
     move-exception p0
 
     const-string v0, "Failure starting SemSsdidManagerService"
 
     invoke-static {v1, v0, p0}, Landroid/util/Slog;->e(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)I
 
-    :goto_7
+    :goto_6
     invoke-virtual {v2}, Landroid/util/TimingsTraceLog;->traceEnd()V
 
     return-void
diff --git a/smali_classes2/com/samsung/ucm/ucmservice/CredentialManagerService.smali b/smali_classes2/com/samsung/ucm/ucmservice/CredentialManagerService.smali
index cfbf9fd05..1b0f813af 100644
--- a/smali_classes2/com/samsung/ucm/ucmservice/CredentialManagerService.smali
+++ b/smali_classes2/com/samsung/ucm/ucmservice/CredentialManagerService.smali
@@ -22414,7 +22414,7 @@
     :cond_16
     const-string/jumbo v0, "applet_ese_chip_vendor"
 
-    const-string/jumbo v4, "NXP"
+    const-string v4, ""
 
     invoke-virtual {v9, v0, v4}, Landroid/os/Bundle;->putString(Ljava/lang/String;Ljava/lang/String;)V
 
@@ -22494,8 +22494,6 @@
 
     throw v0
 
-    nop
-
     :sswitch_data_0
     .sparse-switch
         0xa51 -> :sswitch_7
-- 
2.51.2

